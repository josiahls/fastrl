<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Basic pytorch functions used in the fastai/fastrl library">

<title>fastrl - Torch Core</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="fastrl - Torch Core">
<meta property="og:description" content="Basic pytorch functions used in the fastai/fastrl library">
<meta property="og:site-name" content="fastrl">
<meta name="twitter:title" content="fastrl - Torch Core">
<meta name="twitter:description" content="Basic pytorch functions used in the fastai/fastrl library">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">fastrl</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Torch Core</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">fastrl</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../core.html" class="sidebar-item-text sidebar-link">Core</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nbdev_extension.html" class="sidebar-item-text sidebar-link">Nbdev Extensions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cli.html" class="sidebar-item-text sidebar-link">CLI</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../test_utils.html" class="sidebar-item-text sidebar-link">Synth Agent</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Fastai</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00_Fastai/torch_core.html" class="sidebar-item-text sidebar-link active">Torch Core</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">DataPipes</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_DataPipes/pipes.core.html" class="sidebar-item-text sidebar-link">Pipes Core</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_DataPipes/pipes.map.demux.html" class="sidebar-item-text sidebar-link">DeMultiplexer</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_DataPipes/pipes.map.mux.html" class="sidebar-item-text sidebar-link">Multiplexer</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_DataPipes/pipes.iter.nskip.html" class="sidebar-item-text sidebar-link">NSkip</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_DataPipes/pipes.iter.nstep.html" class="sidebar-item-text sidebar-link">NStep</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_DataPipes/pipes.iter.firstlast.html" class="sidebar-item-text sidebar-link">FirstLast</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_DataPipes/pipes.iter.transforms.html" class="sidebar-item-text sidebar-link">Item and Batch Transforms</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_DataPipes/pipes.map.transforms.html" class="sidebar-item-text sidebar-link">Type Transforms</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">DataLoading</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_DataLoading/data.dataloader2.html" class="sidebar-item-text sidebar-link">DataLoader2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_DataLoading/data.block.html" class="sidebar-item-text sidebar-link">Data Block</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Environment</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Environment/envs.gym.html" class="sidebar-item-text sidebar-link">Envs Gym</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Memory</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_Memory/memory.experience_replay.html" class="sidebar-item-text sidebar-link">Experience Replay</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Logging</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_Logging/loggers.core.html" class="sidebar-item-text sidebar-link">Loggers Core</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_Logging/loggers.jupyter_visualizers.html" class="sidebar-item-text sidebar-link">Visualizers</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_Logging/loggers.tensorboard.html" class="sidebar-item-text sidebar-link">Tensorboard</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_Logging/loggers.vscode_visualizers.html" class="sidebar-item-text sidebar-link">Visualizers - VS-Code</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">Learning</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_Learning/learner.core.html" class="sidebar-item-text sidebar-link">Learner Core</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">Agents</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_Agents/agents.core.html" class="sidebar-item-text sidebar-link">Agent Core</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">Discrete</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_Agents/01_Discrete/agents.discrete.html" class="sidebar-item-text sidebar-link">Agent Discrete</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_Agents/01_Discrete/agents.dqn.basic.html" class="sidebar-item-text sidebar-link">DQN Basic</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_Agents/01_Discrete/agents.dqn.target.html" class="sidebar-item-text sidebar-link">DQN Target</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_Agents/01_Discrete/agents.dqn.asynchronous.html" class="sidebar-item-text sidebar-link">DQN Async</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_Agents/01_Discrete/agents.dqn.double.html" class="sidebar-item-text sidebar-link">DQN Double</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_Agents/01_Discrete/agents.dqn.dueling.html" class="sidebar-item-text sidebar-link">DQN Dueling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_Agents/01_Discrete/agents.dqn.categorical.html" class="sidebar-item-text sidebar-link">Categorical DQN</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_Agents/01_Discrete/agents.dqn.rainbow.html" class="sidebar-item-text sidebar-link">DQN Rainbow</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false">Continuous</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_Agents/02_Continuous/agents.ddpg.html" class="sidebar-item-text sidebar-link">DDPG</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">FAQ</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_FAQ/99_notes.multi_proc.html" class="sidebar-item-text sidebar-link">MultiProcessing Notes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_FAQ/notes.pipe_insertion.html" class="sidebar-item-text sidebar-link">TorchData DataPipe Notes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_FAQ/notes.speed.html" class="sidebar-item-text sidebar-link">Speed</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_FAQ/template.html" class="sidebar-item-text sidebar-link">Template</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#pv" id="toc-pv" class="nav-link active" data-scroll-target="#pv">pv</a></li>
  <li><a href="#equals" id="toc-equals" class="nav-link" data-scroll-target="#equals">equals</a></li>
  <li><a href="#one_is_instance" id="toc-one_is_instance" class="nav-link" data-scroll-target="#one_is_instance">one_is_instance</a></li>
  <li><a href="#noops" id="toc-noops" class="nav-link" data-scroll-target="#noops">noops</a></li>
  <li><a href="#noop" id="toc-noop" class="nav-link" data-scroll-target="#noop">noop</a></li>
  <li><a href="#all_equal" id="toc-all_equal" class="nav-link" data-scroll-target="#all_equal">all_equal</a></li>
  <li><a href="#is_coll" id="toc-is_coll" class="nav-link" data-scroll-target="#is_coll">is_coll</a></li>
  <li><a href="#is_iter" id="toc-is_iter" class="nav-link" data-scroll-target="#is_iter">is_iter</a></li>
  <li><a href="#setup_cuda" id="toc-setup_cuda" class="nav-link" data-scroll-target="#setup_cuda">setup_cuda</a></li>
  <li><a href="#arrays-and-show" id="toc-arrays-and-show" class="nav-link" data-scroll-target="#arrays-and-show">Arrays and show</a>
  <ul class="collapse">
  <li><a href="#subplots" id="toc-subplots" class="nav-link" data-scroll-target="#subplots">subplots</a></li>
  <li><a href="#show_image" id="toc-show_image" class="nav-link" data-scroll-target="#show_image">show_image</a></li>
  <li><a href="#show_titled_image" id="toc-show_titled_image" class="nav-link" data-scroll-target="#show_titled_image">show_titled_image</a></li>
  <li><a href="#show_images" id="toc-show_images" class="nav-link" data-scroll-target="#show_images">show_images</a></li>
  <li><a href="#arraybase" id="toc-arraybase" class="nav-link" data-scroll-target="#arraybase">ArrayBase</a></li>
  <li><a href="#arrayimagebase" id="toc-arrayimagebase" class="nav-link" data-scroll-target="#arrayimagebase">ArrayImageBase</a></li>
  <li><a href="#arrayimage" id="toc-arrayimage" class="nav-link" data-scroll-target="#arrayimage">ArrayImage</a></li>
  <li><a href="#arrayimagebw" id="toc-arrayimagebw" class="nav-link" data-scroll-target="#arrayimagebw">ArrayImageBW</a></li>
  <li><a href="#arraymask" id="toc-arraymask" class="nav-link" data-scroll-target="#arraymask">ArrayMask</a></li>
  </ul></li>
  <li><a href="#basics" id="toc-basics" class="nav-link" data-scroll-target="#basics">Basics</a>
  <ul class="collapse">
  <li><a href="#evaluating" id="toc-evaluating" class="nav-link" data-scroll-target="#evaluating">evaluating</a></li>
  <li><a href="#tensor" id="toc-tensor" class="nav-link" data-scroll-target="#tensor">tensor</a></li>
  <li><a href="#set_seed" id="toc-set_seed" class="nav-link" data-scroll-target="#set_seed">set_seed</a></li>
  <li><a href="#get_random_states" id="toc-get_random_states" class="nav-link" data-scroll-target="#get_random_states">get_random_states</a></li>
  <li><a href="#set_random_states" id="toc-set_random_states" class="nav-link" data-scroll-target="#set_random_states">set_random_states</a></li>
  <li><a href="#no_random" id="toc-no_random" class="nav-link" data-scroll-target="#no_random">no_random</a></li>
  <li><a href="#unsqueeze" id="toc-unsqueeze" class="nav-link" data-scroll-target="#unsqueeze">unsqueeze</a></li>
  <li><a href="#unsqueeze_" id="toc-unsqueeze_" class="nav-link" data-scroll-target="#unsqueeze_">unsqueeze_</a></li>
  <li><a href="#apply" id="toc-apply" class="nav-link" data-scroll-target="#apply">apply</a></li>
  <li><a href="#maybe_gather" id="toc-maybe_gather" class="nav-link" data-scroll-target="#maybe_gather">maybe_gather</a></li>
  <li><a href="#to_detach" id="toc-to_detach" class="nav-link" data-scroll-target="#to_detach">to_detach</a></li>
  <li><a href="#to_half" id="toc-to_half" class="nav-link" data-scroll-target="#to_half">to_half</a></li>
  <li><a href="#to_float" id="toc-to_float" class="nav-link" data-scroll-target="#to_float">to_float</a></li>
  <li><a href="#default_device" id="toc-default_device" class="nav-link" data-scroll-target="#default_device">default_device</a></li>
  <li><a href="#default_device-1" id="toc-default_device-1" class="nav-link" data-scroll-target="#default_device-1">default_device</a></li>
  <li><a href="#to_device" id="toc-to_device" class="nav-link" data-scroll-target="#to_device">to_device</a></li>
  <li><a href="#to_cpu" id="toc-to_cpu" class="nav-link" data-scroll-target="#to_cpu">to_cpu</a></li>
  <li><a href="#to_np" id="toc-to_np" class="nav-link" data-scroll-target="#to_np">to_np</a></li>
  <li><a href="#to_concat" id="toc-to_concat" class="nav-link" data-scroll-target="#to_concat">to_concat</a></li>
  </ul></li>
  <li><a href="#tensor-subtypes" id="toc-tensor-subtypes" class="nav-link" data-scroll-target="#tensor-subtypes">Tensor subtypes</a>
  <ul class="collapse">
  <li><a href="#tensor.set_meta" id="toc-tensor.set_meta" class="nav-link" data-scroll-target="#tensor.set_meta">Tensor.set_meta</a></li>
  <li><a href="#tensor.as_subclass" id="toc-tensor.as_subclass" class="nav-link" data-scroll-target="#tensor.as_subclass">Tensor.as_subclass</a></li>
  <li><a href="#tensorbase" id="toc-tensorbase" class="nav-link" data-scroll-target="#tensorbase">TensorBase</a></li>
  <li><a href="#tensorimagebase" id="toc-tensorimagebase" class="nav-link" data-scroll-target="#tensorimagebase">TensorImageBase</a></li>
  <li><a href="#tensorimage" id="toc-tensorimage" class="nav-link" data-scroll-target="#tensorimage">TensorImage</a></li>
  <li><a href="#tensorimagebw" id="toc-tensorimagebw" class="nav-link" data-scroll-target="#tensorimagebw">TensorImageBW</a></li>
  <li><a href="#tensormask" id="toc-tensormask" class="nav-link" data-scroll-target="#tensormask">TensorMask</a></li>
  <li><a href="#tensorflowfield" id="toc-tensorflowfield" class="nav-link" data-scroll-target="#tensorflowfield">TensorFlowField</a></li>
  <li><a href="#tensorcategory" id="toc-tensorcategory" class="nav-link" data-scroll-target="#tensorcategory">TensorCategory</a></li>
  <li><a href="#tensormulticategory" id="toc-tensormulticategory" class="nav-link" data-scroll-target="#tensormulticategory">TensorMultiCategory</a></li>
  <li><a href="#titledtensorscalar" id="toc-titledtensorscalar" class="nav-link" data-scroll-target="#titledtensorscalar">TitledTensorScalar</a></li>
  <li><a href="#l.cat" id="toc-l.cat" class="nav-link" data-scroll-target="#l.cat">L.cat</a></li>
  <li><a href="#l.stack" id="toc-l.stack" class="nav-link" data-scroll-target="#l.stack">L.stack</a></li>
  <li><a href="#l.tensored" id="toc-l.tensored" class="nav-link" data-scroll-target="#l.tensored">L.tensored</a></li>
  <li><a href="#l.tensored-1" id="toc-l.tensored-1" class="nav-link" data-scroll-target="#l.tensored-1">L.tensored</a></li>
  <li><a href="#l.stack-1" id="toc-l.stack-1" class="nav-link" data-scroll-target="#l.stack-1">L.stack</a></li>
  <li><a href="#l.cat-1" id="toc-l.cat-1" class="nav-link" data-scroll-target="#l.cat-1">L.cat</a></li>
  </ul></li>
  <li><a href="#chunks" id="toc-chunks" class="nav-link" data-scroll-target="#chunks">Chunks</a>
  <ul class="collapse">
  <li><a href="#concat" id="toc-concat" class="nav-link" data-scroll-target="#concat">concat</a></li>
  <li><a href="#chunks-1" id="toc-chunks-1" class="nav-link" data-scroll-target="#chunks-1">Chunks</a></li>
  </ul></li>
  <li><a href="#simple-types" id="toc-simple-types" class="nav-link" data-scroll-target="#simple-types">Simple types</a>
  <ul class="collapse">
  <li><a href="#show_title" id="toc-show_title" class="nav-link" data-scroll-target="#show_title">show_title</a></li>
  <li><a href="#showtitle" id="toc-showtitle" class="nav-link" data-scroll-target="#showtitle">ShowTitle</a></li>
  <li><a href="#titledint" id="toc-titledint" class="nav-link" data-scroll-target="#titledint">TitledInt</a></li>
  <li><a href="#titledstr" id="toc-titledstr" class="nav-link" data-scroll-target="#titledstr">TitledStr</a></li>
  <li><a href="#titledfloat" id="toc-titledfloat" class="nav-link" data-scroll-target="#titledfloat">TitledFloat</a></li>
  <li><a href="#titledtuple" id="toc-titledtuple" class="nav-link" data-scroll-target="#titledtuple">TitledTuple</a></li>
  <li><a href="#titledstr.truncate" id="toc-titledstr.truncate" class="nav-link" data-scroll-target="#titledstr.truncate">TitledStr.truncate</a></li>
  </ul></li>
  <li><a href="#other-functions" id="toc-other-functions" class="nav-link" data-scroll-target="#other-functions">Other functions</a>
  <ul class="collapse">
  <li><a href="#get_empty_df" id="toc-get_empty_df" class="nav-link" data-scroll-target="#get_empty_df">get_empty_df</a></li>
  <li><a href="#display_df" id="toc-display_df" class="nav-link" data-scroll-target="#display_df">display_df</a></li>
  <li><a href="#get_first" id="toc-get_first" class="nav-link" data-scroll-target="#get_first">get_first</a></li>
  <li><a href="#one_param" id="toc-one_param" class="nav-link" data-scroll-target="#one_param">one_param</a></li>
  <li><a href="#item_find" id="toc-item_find" class="nav-link" data-scroll-target="#item_find">item_find</a></li>
  <li><a href="#find_device" id="toc-find_device" class="nav-link" data-scroll-target="#find_device">find_device</a></li>
  <li><a href="#find_bs" id="toc-find_bs" class="nav-link" data-scroll-target="#find_bs">find_bs</a></li>
  <li><a href="#np_func" id="toc-np_func" class="nav-link" data-scroll-target="#np_func">np_func</a></li>
  <li><a href="#module" id="toc-module" class="nav-link" data-scroll-target="#module">Module</a></li>
  <li><a href="#get_model" id="toc-get_model" class="nav-link" data-scroll-target="#get_model">get_model</a></li>
  <li><a href="#one_hot" id="toc-one_hot" class="nav-link" data-scroll-target="#one_hot">one_hot</a></li>
  <li><a href="#one_hot_decode" id="toc-one_hot_decode" class="nav-link" data-scroll-target="#one_hot_decode">one_hot_decode</a></li>
  <li><a href="#params" id="toc-params" class="nav-link" data-scroll-target="#params">params</a></li>
  <li><a href="#trainable_params" id="toc-trainable_params" class="nav-link" data-scroll-target="#trainable_params">trainable_params</a></li>
  <li><a href="#norm_bias_params" id="toc-norm_bias_params" class="nav-link" data-scroll-target="#norm_bias_params">norm_bias_params</a></li>
  <li><a href="#batch_to_samples" id="toc-batch_to_samples" class="nav-link" data-scroll-target="#batch_to_samples">batch_to_samples</a></li>
  <li><a href="#tensor.interp_1d" id="toc-tensor.interp_1d" class="nav-link" data-scroll-target="#tensor.interp_1d">Tensor.interp_1d</a></li>
  <li><a href="#tensor.pca" id="toc-tensor.pca" class="nav-link" data-scroll-target="#tensor.pca">Tensor.pca</a></li>
  <li><a href="#logit" id="toc-logit" class="nav-link" data-scroll-target="#logit">logit</a></li>
  <li><a href="#num_distrib" id="toc-num_distrib" class="nav-link" data-scroll-target="#num_distrib">num_distrib</a></li>
  <li><a href="#rank_distrib" id="toc-rank_distrib" class="nav-link" data-scroll-target="#rank_distrib">rank_distrib</a></li>
  <li><a href="#distrib_barrier" id="toc-distrib_barrier" class="nav-link" data-scroll-target="#distrib_barrier">distrib_barrier</a></li>
  <li><a href="#path.save_array" id="toc-path.save_array" class="nav-link" data-scroll-target="#path.save_array">Path.save_array</a></li>
  <li><a href="#path.load_array" id="toc-path.load_array" class="nav-link" data-scroll-target="#path.load_array">Path.load_array</a></li>
  <li><a href="#base_doc" id="toc-base_doc" class="nav-link" data-scroll-target="#base_doc">base_doc</a></li>
  <li><a href="#doc" id="toc-doc" class="nav-link" data-scroll-target="#doc">doc</a></li>
  <li><a href="#nested_reorder" id="toc-nested_reorder" class="nav-link" data-scroll-target="#nested_reorder">nested_reorder</a></li>
  <li><a href="#flatten_check" id="toc-flatten_check" class="nav-link" data-scroll-target="#flatten_check">flatten_check</a></li>
  </ul></li>
  <li><a href="#image-helpers" id="toc-image-helpers" class="nav-link" data-scroll-target="#image-helpers">Image helpers</a>
  <ul class="collapse">
  <li><a href="#make_cross_image" id="toc-make_cross_image" class="nav-link" data-scroll-target="#make_cross_image">make_cross_image</a></li>
  <li><a href="#show_image_batch" id="toc-show_image_batch" class="nav-link" data-scroll-target="#show_image_batch">show_image_batch</a></li>
  </ul></li>
  <li><a href="#model-init" id="toc-model-init" class="nav-link" data-scroll-target="#model-init">Model init</a>
  <ul class="collapse">
  <li><a href="#requires_grad" id="toc-requires_grad" class="nav-link" data-scroll-target="#requires_grad">requires_grad</a></li>
  <li><a href="#init_default" id="toc-init_default" class="nav-link" data-scroll-target="#init_default">init_default</a></li>
  <li><a href="#cond_init" id="toc-cond_init" class="nav-link" data-scroll-target="#cond_init">cond_init</a></li>
  <li><a href="#apply_leaf" id="toc-apply_leaf" class="nav-link" data-scroll-target="#apply_leaf">apply_leaf</a></li>
  <li><a href="#apply_init" id="toc-apply_init" class="nav-link" data-scroll-target="#apply_init">apply_init</a></li>
  </ul></li>
  <li><a href="#autograd-jit-functions" id="toc-autograd-jit-functions" class="nav-link" data-scroll-target="#autograd-jit-functions">autograd jit functions</a>
  <ul class="collapse">
  <li><a href="#script_use_ctx" id="toc-script_use_ctx" class="nav-link" data-scroll-target="#script_use_ctx">script_use_ctx</a></li>
  <li><a href="#script_save_ctx" id="toc-script_save_ctx" class="nav-link" data-scroll-target="#script_save_ctx">script_save_ctx</a></li>
  <li><a href="#script_fwd" id="toc-script_fwd" class="nav-link" data-scroll-target="#script_fwd">script_fwd</a></li>
  <li><a href="#script_bwd" id="toc-script_bwd" class="nav-link" data-scroll-target="#script_bwd">script_bwd</a></li>
  <li><a href="#grad_module" id="toc-grad_module" class="nav-link" data-scroll-target="#grad_module">grad_module</a></li>
  <li><a href="#ismin_torch" id="toc-ismin_torch" class="nav-link" data-scroll-target="#ismin_torch">ismin_torch</a></li>
  <li><a href="#notmax_torch" id="toc-notmax_torch" class="nav-link" data-scroll-target="#notmax_torch">notmax_torch</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/josiahls/fastrl/tree/main/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Torch Core</h1>
</div>

<div>
  <div class="description">
    Basic pytorch functions used in the fastai/fastrl library
  </div>
</div>


<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<blockquote class="blockquote">
<p>Important: Fastai is not a direct dependency, but we want the ability to use some of the torch utilites offered by fastai, we have this notebook, which has been copied from: <a href="https://github.com/fastai/fastai/blob/26f74bf289aa87abc14d049665b671ca4abfcfee/nbs/00_torch_core.ipynb">fastai</a>. At some point having fastai as a direct dep would be good, however for know we are keeping the number of deps as low as we can.</p>
</blockquote>
<hr>
<section id="pv" class="level3">
<h3 class="anchored" data-anchor-id="pv">pv</h3>
<blockquote class="blockquote">
<pre><code> pv (text, verbose)</code></pre>
</blockquote>
<hr>
</section>
<section id="equals" class="level3">
<h3 class="anchored" data-anchor-id="equals">equals</h3>
<blockquote class="blockquote">
<pre><code> equals (a, b)</code></pre>
</blockquote>
<p>Compares <code>a</code> and <code>b</code> for equality; supports sublists, tensors and arrays too</p>
<hr>
</section>
<section id="one_is_instance" class="level3">
<h3 class="anchored" data-anchor-id="one_is_instance">one_is_instance</h3>
<blockquote class="blockquote">
<pre><code> one_is_instance (a, b, t)</code></pre>
</blockquote>
<hr>
</section>
<section id="noops" class="level3">
<h3 class="anchored" data-anchor-id="noops">noops</h3>
<blockquote class="blockquote">
<pre><code> noops (x=None, *args, **kwargs)</code></pre>
</blockquote>
<p>Do nothing (method)</p>
<hr>
</section>
<section id="noop" class="level3">
<h3 class="anchored" data-anchor-id="noop">noop</h3>
<blockquote class="blockquote">
<pre><code> noop (x=None, *args, **kwargs)</code></pre>
</blockquote>
<p>Do nothing</p>
<hr>
</section>
<section id="all_equal" class="level3">
<h3 class="anchored" data-anchor-id="all_equal">all_equal</h3>
<blockquote class="blockquote">
<pre><code> all_equal (a, b)</code></pre>
</blockquote>
<p>Compares whether <code>a</code> and <code>b</code> are the same length and have the same contents</p>
<hr>
</section>
<section id="is_coll" class="level3">
<h3 class="anchored" data-anchor-id="is_coll">is_coll</h3>
<blockquote class="blockquote">
<pre><code> is_coll (o)</code></pre>
</blockquote>
<p>Test whether <code>o</code> is a collection (i.e.&nbsp;has a usable <code>len</code>)</p>
<hr>
</section>
<section id="is_iter" class="level3">
<h3 class="anchored" data-anchor-id="is_iter">is_iter</h3>
<blockquote class="blockquote">
<pre><code> is_iter (o)</code></pre>
</blockquote>
<p>Test whether <code>o</code> can be used in a <code>for</code> loop</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="setup_cuda" class="level3">
<h3 class="anchored" data-anchor-id="setup_cuda">setup_cuda</h3>
<blockquote class="blockquote">
<pre><code> setup_cuda (benchmark=True)</code></pre>
</blockquote>
<p>Sets the main cuda device and sets <code>cudnn.benchmark</code> to <code>benchmark</code></p>
</section>
<section id="arrays-and-show" class="level2">
<h2 class="anchored" data-anchor-id="arrays-and-show">Arrays and show</h2>
<hr>
<section id="subplots" class="level3">
<h3 class="anchored" data-anchor-id="subplots">subplots</h3>
<blockquote class="blockquote">
<pre><code> subplots (nrows:int=1, ncols:int=1, figsize:tuple=None, imsize:int=3,
           suptitle:str=None, sharex=False, sharey=False, squeeze=True,
           subplot_kw=None, gridspec_kw=None, **kwargs)</code></pre>
</blockquote>
<p>Returns a figure and set of subplots to display images of <code>imsize</code> inches</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>nrows</td>
<td>int</td>
<td>1</td>
<td>Number of rows in returned axes grid</td>
</tr>
<tr class="even">
<td>ncols</td>
<td>int</td>
<td>1</td>
<td>Number of columns in returned axes grid</td>
</tr>
<tr class="odd">
<td>figsize</td>
<td>tuple</td>
<td>None</td>
<td>Width, height in inches of the returned figure</td>
</tr>
<tr class="even">
<td>imsize</td>
<td>int</td>
<td>3</td>
<td>Size (in inches) of images that will be displayed in the returned figure</td>
</tr>
<tr class="odd">
<td>suptitle</td>
<td>str</td>
<td>None</td>
<td>Title to be set to returned figure</td>
</tr>
<tr class="even">
<td>sharex</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr class="odd">
<td>sharey</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr class="even">
<td>squeeze</td>
<td>bool</td>
<td>True</td>
<td></td>
</tr>
<tr class="odd">
<td>subplot_kw</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>gridspec_kw</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>kwargs</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>(&lt;class ‘matplotlib.figure.Figure’&gt;, &lt;class ‘matplotlib.axes._axes.Axes’&gt;)</strong></td>
<td></td>
<td><strong>Returns both fig and ax as a tuple</strong></td>
</tr>
</tbody>
</table>
<p>This is used in <code>get_grid</code>. <code>suptitle</code>, <code>sharex</code>, <code>sharey</code>, <code>squeeze</code>, <code>subplot_kw</code> and <code>gridspec_kw</code> are all passed down to <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib-pyplot-subplots">plt.subplots</a>.</p>
<hr>
</section>
<section id="show_image" class="level3">
<h3 class="anchored" data-anchor-id="show_image">show_image</h3>
<blockquote class="blockquote">
<pre><code> show_image (im, ax=None, figsize=None, title=None, ctx=None, cmap=None,
             norm=None, aspect=None, interpolation=None, alpha=None,
             vmin=None, vmax=None, origin=None, extent=None,
             interpolation_stage=None, filternorm=True, filterrad=4.0,
             resample=None, url=None, data=None, **kwargs)</code></pre>
</blockquote>
<p>Show a PIL or PyTorch image on <code>ax</code>.</p>
<p><code>show_image</code> can show PIL images…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> Image.<span class="bu">open</span>(TEST_IMAGE_BW)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> show_image(im, cmap<span class="op">=</span><span class="st">"Greys"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="00_torch_core_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>…and color images with standard <code>CHW</code> dim order…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>im2 <span class="op">=</span> np.array(Image.<span class="bu">open</span>(TEST_IMAGE))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> show_image(im2, figsize<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="00_torch_core_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>…and color images with <code>HWC</code> dim order…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>im3 <span class="op">=</span> torch.as_tensor(im2).permute(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> show_image(im3, figsize<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="00_torch_core_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
</section>
<section id="show_titled_image" class="level3">
<h3 class="anchored" data-anchor-id="show_titled_image">show_titled_image</h3>
<blockquote class="blockquote">
<pre><code> show_titled_image (o, ax=None, figsize=None, title=None, ctx=None,
                    cmap=None, norm=None, aspect=None, interpolation=None,
                    alpha=None, vmin=None, vmax=None, origin=None,
                    extent=None, interpolation_stage=None,
                    filternorm=True, filterrad=4.0, resample=None,
                    url=None, data=None, **kwargs)</code></pre>
</blockquote>
<p>Call <code>show_image</code> destructuring <code>o</code> to <code>(img,title)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>show_titled_image((im3,<span class="st">'A puppy'</span>), figsize<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="00_torch_core_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Show all images <code>ims</code> as subplots with <code>rows</code> using <code>titles</code>. <code>suptitle</code> provides a way to create a figure title for all images. If you use <code>suptitle</code>, <code>constrained_layout</code> is used unless you set <code>constrained_layout</code> to <code>False</code>.</p>
<hr>
</section>
<section id="show_images" class="level3">
<h3 class="anchored" data-anchor-id="show_images">show_images</h3>
<blockquote class="blockquote">
<pre><code> show_images (ims, nrows=1, ncols=None, titles=None, figsize:tuple=None,
              imsize:int=3, suptitle:str=None, sharex=False, sharey=False,
              squeeze=True, subplot_kw=None, gridspec_kw=None)</code></pre>
</blockquote>
<p>Show all images <code>ims</code> as subplots with <code>rows</code> using <code>titles</code>.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ims</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>nrows</td>
<td>int</td>
<td>1</td>
<td>Number of rows in returned axes grid</td>
</tr>
<tr class="odd">
<td>ncols</td>
<td>int</td>
<td>1</td>
<td>Number of columns in returned axes grid</td>
</tr>
<tr class="even">
<td>titles</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>figsize</td>
<td>tuple</td>
<td>None</td>
<td>Width, height in inches of the returned figure</td>
</tr>
<tr class="even">
<td>imsize</td>
<td>int</td>
<td>3</td>
<td>Size (in inches) of images that will be displayed in the returned figure</td>
</tr>
<tr class="odd">
<td>suptitle</td>
<td>str</td>
<td>None</td>
<td>Title to be set to returned figure</td>
</tr>
<tr class="even">
<td>sharex</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr class="odd">
<td>sharey</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr class="even">
<td>squeeze</td>
<td>bool</td>
<td>True</td>
<td></td>
</tr>
<tr class="odd">
<td>subplot_kw</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>gridspec_kw</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>(&lt;class ‘matplotlib.figure.Figure’&gt;, &lt;class ‘matplotlib.axes._axes.Axes’&gt;)</strong></td>
<td></td>
<td><strong>Returns both fig and ax as a tuple</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>show_images((im,im3),titles<span class="op">=</span>(<span class="st">'number'</span>,<span class="st">'puppy'</span>),suptitle<span class="op">=</span><span class="st">'Number Puppy'</span>,  imsize<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="00_torch_core_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><code>ArrayImage</code>, <code>ArrayImageBW</code> and <code>ArrayMask</code> are subclasses of <code>ndarray</code> that know how to show themselves.</p>
<hr>
</section>
<section id="arraybase" class="level3">
<h3 class="anchored" data-anchor-id="arraybase">ArrayBase</h3>
<p>An <code>ndarray</code> that can modify casting behavior</p>
<hr>
</section>
<section id="arrayimagebase" class="level3">
<h3 class="anchored" data-anchor-id="arrayimagebase">ArrayImageBase</h3>
<p>Base class for arrays representing images</p>
<hr>
</section>
<section id="arrayimage" class="level3">
<h3 class="anchored" data-anchor-id="arrayimage">ArrayImage</h3>
<p>An array representing an image</p>
<hr>
</section>
<section id="arrayimagebw" class="level3">
<h3 class="anchored" data-anchor-id="arrayimagebw">ArrayImageBW</h3>
<p>An array representing an image</p>
<hr>
</section>
<section id="arraymask" class="level3">
<h3 class="anchored" data-anchor-id="arraymask">ArrayMask</h3>
<p>An array representing an image mask</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> Image.<span class="bu">open</span>(TEST_IMAGE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>im_t <span class="op">=</span> cast(im, ArrayImage)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">type</span>(im_t), ArrayImage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> im_t.show(figsize<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="00_torch_core_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>test_fig_exists(ax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="basics" class="level2">
<h2 class="anchored" data-anchor-id="basics">Basics</h2>
<hr>
<section id="evaluating" class="level3">
<h3 class="anchored" data-anchor-id="evaluating">evaluating</h3>
<blockquote class="blockquote">
<pre><code> evaluating (model)</code></pre>
</blockquote>
<p>Temporarily switch to evaluation mode.</p>
<hr>
</section>
<section id="tensor" class="level3">
<h3 class="anchored" data-anchor-id="tensor">tensor</h3>
<blockquote class="blockquote">
<pre><code> tensor (x, *rest, dtype=None, device=None, requires_grad=False,
         pin_memory=False)</code></pre>
</blockquote>
<p>Like <code>torch.as_tensor</code>, but handle lists too, and can pass multiple vector elements directly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>test_eq(tensor(torch.tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])), torch.tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>test_eq(tensor(array([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])), torch.tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>test_eq(tensor(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), torch.tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>test_eq_type(tensor(<span class="fl">1.0</span>), torch.tensor(<span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>set_seed</code> is useful for reproducibility between runs. It is important to remember that certain classes such as <code>Dataloaders</code> have internal random number generators that is not effected by this function, so this must be run before such objects are created in order to guarantee reproducibility.</p>
<hr>
</section>
<section id="set_seed" class="level3">
<h3 class="anchored" data-anchor-id="set_seed">set_seed</h3>
<blockquote class="blockquote">
<pre><code> set_seed (s, reproducible=False)</code></pre>
</blockquote>
<p>Set random seed for <code>random</code>, <code>torch</code>, and <code>numpy</code> (where available)</p>
<p>Here is an example of how <code>set_seed</code> can be used to reset the state of random number generators.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>set_seed(<span class="dv">2</span><span class="op">*</span><span class="dv">33</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>a1 <span class="op">=</span> np.random.random()</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>a2 <span class="op">=</span> torch.rand(())</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>a3 <span class="op">=</span> random.random()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>set_seed(<span class="dv">2</span><span class="op">*</span><span class="dv">33</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>b1 <span class="op">=</span> np.random.random()</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>b2 <span class="op">=</span> torch.rand(())</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>b3 <span class="op">=</span> random.random()</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'a</span><span class="ch">\'</span><span class="st">s: </span><span class="sc">{0:3.3f}</span><span class="st"> </span><span class="sc">{1:3.3f}</span><span class="st"> </span><span class="sc">{2:3.3f}</span><span class="st">'</span>.<span class="bu">format</span>(a1,a2,a3))</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'b</span><span class="ch">\'</span><span class="st">s: </span><span class="sc">{0:3.3f}</span><span class="st"> </span><span class="sc">{1:3.3f}</span><span class="st"> </span><span class="sc">{2:3.3f}</span><span class="st">'</span>.<span class="bu">format</span>(b1,b2,a3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a's: 0.154 0.498 0.071
b's: 0.154 0.498 0.071</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>test_eq(a1,b1)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>test_eq(a2,b2)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>test_eq(a3,b3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>get_random_states</code> and <code>set_random_states</code> are useful for storing a state so you can go back to it later.</p>
<hr>
</section>
<section id="get_random_states" class="level3">
<h3 class="anchored" data-anchor-id="get_random_states">get_random_states</h3>
<blockquote class="blockquote">
<pre><code> get_random_states ()</code></pre>
</blockquote>
<p>Gets states for <code>random</code>, <code>torch</code>, and <code>numpy</code> random number generators</p>
<hr>
</section>
<section id="set_random_states" class="level3">
<h3 class="anchored" data-anchor-id="set_random_states">set_random_states</h3>
<blockquote class="blockquote">
<pre><code> set_random_states (random_state, numpy_state, torch_state,
                    torch_cuda_state, torch_deterministic,
                    torch_benchmark)</code></pre>
</blockquote>
<p>Set states for <code>random</code>, <code>torch</code>, and <code>numpy</code> random number generators</p>
<p>Below notice that the old values and rewinded values are the same because we were able to return to the previous state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>old_states <span class="op">=</span> get_random_states()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>olds <span class="op">=</span> (random.random(),np.random.random(),torch.rand(()))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>news <span class="op">=</span> (random.random(),np.random.random(),torch.rand(()))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>set_random_states(<span class="op">**</span>old_states)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>rewinds <span class="op">=</span> (random.random(),np.random.random(),torch.rand(()))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'olds:    </span><span class="sc">{0:3.3f}</span><span class="st"> </span><span class="sc">{1:3.3f}</span><span class="st"> </span><span class="sc">{2:3.3f}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="op">*</span>olds))</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'news:    </span><span class="sc">{0:3.3f}</span><span class="st"> </span><span class="sc">{1:3.3f}</span><span class="st"> </span><span class="sc">{2:3.3f}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="op">*</span>news))</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'rewinds: </span><span class="sc">{0:3.3f}</span><span class="st"> </span><span class="sc">{1:3.3f}</span><span class="st"> </span><span class="sc">{2:3.3f}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="op">*</span>rewinds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>olds:    0.435 0.134 0.023
news:    0.246 0.363 0.227
rewinds: 0.435 0.134 0.023</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>test_ne(olds,news)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>test_eq(olds,rewinds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In <code>no_random</code> we combine the ideas of rewinding state with <code>get_random_states</code> and <code>set_random_states</code> with the ability to <code>set_seed</code> and create a context manager that can allow us to control randomness in a portion of our code.</p>
<p>Note: Similar to <code>torch.random.fork_rng</code>, but also with <code>numpy</code> and <code>random</code></p>
<hr>
</section>
<section id="no_random" class="level3">
<h3 class="anchored" data-anchor-id="no_random">no_random</h3>
<blockquote class="blockquote">
<pre><code> no_random (seed=42, reproducible=True)</code></pre>
</blockquote>
<p>Stores and retrieves state of random number generators. Sets random seed for <code>random</code>, <code>torch</code>, and <code>numpy</code>.</p>
<p>Here are some examples on how we can use <code>no_random</code> to control the randomness within a block of code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>states<span class="op">=</span>get_random_states()</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>olds <span class="op">=</span> (random.random(),np.random.random(),torch.rand(()))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>set_random_states(<span class="op">**</span>states) <span class="co">#rewinding above random calls</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> no_random():</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    new1 <span class="op">=</span> (random.random(),np.random.random(),torch.rand(()))</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> no_random():</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    new2 <span class="op">=</span> (random.random(),np.random.random(),torch.rand(()))</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> no_random(seed<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    seeded1 <span class="op">=</span> (random.random(),np.random.random(),torch.rand(()))</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> no_random(seed<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    seeded2 <span class="op">=</span> (random.random(),np.random.random(),torch.rand(()))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>rewinds <span class="op">=</span> (random.random(),np.random.random(),torch.rand(()))</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'olds:    </span><span class="sc">{0:3.3f}</span><span class="st"> </span><span class="sc">{1:3.3f}</span><span class="st"> </span><span class="sc">{2:3.3f}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="op">*</span>olds))</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'new1:    </span><span class="sc">{0:3.3f}</span><span class="st"> </span><span class="sc">{1:3.3f}</span><span class="st"> </span><span class="sc">{2:3.3f}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="op">*</span>new1))</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'new2:    </span><span class="sc">{0:3.3f}</span><span class="st"> </span><span class="sc">{1:3.3f}</span><span class="st"> </span><span class="sc">{2:3.3f}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="op">*</span>new2))</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'seeded1: </span><span class="sc">{0:3.3f}</span><span class="st"> </span><span class="sc">{1:3.3f}</span><span class="st"> </span><span class="sc">{2:3.3f}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="op">*</span>seeded1))</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'seeded2: </span><span class="sc">{0:3.3f}</span><span class="st"> </span><span class="sc">{1:3.3f}</span><span class="st"> </span><span class="sc">{2:3.3f}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="op">*</span>seeded2))</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'rewinds: </span><span class="sc">{0:3.3f}</span><span class="st"> </span><span class="sc">{1:3.3f}</span><span class="st"> </span><span class="sc">{2:3.3f}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="op">*</span>rewinds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>olds:    0.246 0.363 0.227
new1:    0.639 0.375 0.882
new2:    0.639 0.375 0.882
seeded1: 0.146 0.543 0.112
seeded2: 0.146 0.543 0.112
rewinds: 0.246 0.363 0.227</code></pre>
</div>
</div>
<p>Notice that olds, and rewinds are alos both equal to each other. From this we can see that everything in the <code>with</code> blocks did not update the state outside of the block. Inside of the block, the state is reset for any particular seed, so for the same seed you should get the same random number generator results.</p>
<p>Note: It is important to remember that classes like <code>Dataloader</code> have internal random number generators, and <code>no_random</code> will have no effect on those random number generators.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>test_ne(olds,new1)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>test_eq(new1,new2)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>test_ne(new1,seeded1)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>test_eq(seeded1,seeded2)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>test_eq(olds,rewinds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="unsqueeze" class="level3">
<h3 class="anchored" data-anchor-id="unsqueeze">unsqueeze</h3>
<blockquote class="blockquote">
<pre><code> unsqueeze (x, dim=-1, n=1)</code></pre>
</blockquote>
<p>Same as <code>torch.unsqueeze</code> but can add <code>n</code> dims</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> tensor([<span class="dv">1</span>])</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> unsqueeze(t, n<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>test_eq(t2,t[:,<span class="va">None</span>,<span class="va">None</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="unsqueeze_" class="level3">
<h3 class="anchored" data-anchor-id="unsqueeze_">unsqueeze_</h3>
<blockquote class="blockquote">
<pre><code> unsqueeze_ (x, dim=-1, n=1)</code></pre>
</blockquote>
<p>Same as <code>torch.unsqueeze_</code> but can add <code>n</code> dims</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> tensor([<span class="dv">1</span>])</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>unsqueeze_(t, n<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>test_eq(t, tensor([<span class="dv">1</span>]).view(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="apply" class="level3">
<h3 class="anchored" data-anchor-id="apply">apply</h3>
<blockquote class="blockquote">
<pre><code> apply (func, x, *args, **kwargs)</code></pre>
</blockquote>
<p>Apply <code>func</code> recursively to <code>x</code>, passing on args</p>
<hr>
</section>
<section id="maybe_gather" class="level3">
<h3 class="anchored" data-anchor-id="maybe_gather">maybe_gather</h3>
<blockquote class="blockquote">
<pre><code> maybe_gather (x, axis=0)</code></pre>
</blockquote>
<p>Gather copies of <code>x</code> on <code>axis</code> (if training is distributed)</p>
<hr>
</section>
<section id="to_detach" class="level3">
<h3 class="anchored" data-anchor-id="to_detach">to_detach</h3>
<blockquote class="blockquote">
<pre><code> to_detach (b, cpu=True, gather=True)</code></pre>
</blockquote>
<p>Recursively detach lists of tensors in <code>b</code>; put them on the CPU if <code>cpu=True</code>.</p>
<p><code>gather</code> only applies during distributed training and the result tensor will be the one gathered across processes if <code>gather=True</code> (as a result, the batch size will be multiplied by the number of processes).</p>
<hr>
</section>
<section id="to_half" class="level3">
<h3 class="anchored" data-anchor-id="to_half">to_half</h3>
<blockquote class="blockquote">
<pre><code> to_half (b)</code></pre>
</blockquote>
<p>Recursively map lists of tensors in <code>b</code> to FP16.</p>
<hr>
</section>
<section id="to_float" class="level3">
<h3 class="anchored" data-anchor-id="to_float">to_float</h3>
<blockquote class="blockquote">
<pre><code> to_float (b)</code></pre>
</blockquote>
<p>Recursively map lists of int tensors in <code>b</code> to float.</p>
<hr>
</section>
<section id="default_device" class="level3">
<h3 class="anchored" data-anchor-id="default_device">default_device</h3>
<blockquote class="blockquote">
<pre><code> default_device (use_cuda=-1)</code></pre>
</blockquote>
<p>Return or set default device; <code>use_cuda</code>: None - CUDA if available; True - error if not available; False - CPU</p>
<hr>
</section>
<section id="default_device-1" class="level3">
<h3 class="anchored" data-anchor-id="default_device-1">default_device</h3>
<blockquote class="blockquote">
<pre><code> default_device (use=-1)</code></pre>
</blockquote>
<p>Return or set default device; <code>use_cuda</code>: -1 - CUDA/mps if available; True - error if not available; False - CPU</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    _td <span class="op">=</span> torch.device(torch.cuda.current_device())</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    test_eq(default_device(<span class="op">-</span><span class="dv">1</span>), _td)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    test_eq(default_device(<span class="va">True</span>), _td)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    test_eq(default_device(<span class="va">False</span>), torch.device(<span class="st">'cpu'</span>))</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>default_device(<span class="op">-</span><span class="dv">1</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="to_device" class="level3">
<h3 class="anchored" data-anchor-id="to_device">to_device</h3>
<blockquote class="blockquote">
<pre><code> to_device (b, device=None, non_blocking=False)</code></pre>
</blockquote>
<p>Recursively put <code>b</code> on <code>device</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> to_device((<span class="dv">3</span>,(tensor(<span class="dv">3</span>),tensor(<span class="dv">2</span>))))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>t1,(t2,t3) <span class="op">=</span> t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    test_eq_type(t,(<span class="dv">3</span>,(tensor(<span class="dv">3</span>).cuda(),tensor(<span class="dv">2</span>).cuda())))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    test_eq(t2.<span class="bu">type</span>(), <span class="st">"torch.cuda.LongTensor"</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    test_eq(t3.<span class="bu">type</span>(), <span class="st">"torch.cuda.LongTensor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="to_cpu" class="level3">
<h3 class="anchored" data-anchor-id="to_cpu">to_cpu</h3>
<blockquote class="blockquote">
<pre><code> to_cpu (b)</code></pre>
</blockquote>
<p>Recursively map lists of tensors in <code>b</code> to the cpu.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>t3 <span class="op">=</span> to_cpu(t3)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>test_eq(t3.<span class="bu">type</span>(), <span class="st">"torch.LongTensor"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>test_eq(t3, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="to_np" class="level3">
<h3 class="anchored" data-anchor-id="to_np">to_np</h3>
<blockquote class="blockquote">
<pre><code> to_np (x)</code></pre>
</blockquote>
<p>Convert a tensor to a numpy array.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>t3 <span class="op">=</span> to_np(t3)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">type</span>(t3), np.ndarray)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>test_eq(t3, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="to_concat" class="level3">
<h3 class="anchored" data-anchor-id="to_concat">to_concat</h3>
<blockquote class="blockquote">
<pre><code> to_concat (xs, dim=0)</code></pre>
</blockquote>
<p>Concat the element in <code>xs</code> (recursively if they are tuples/lists of tensors)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>test_eq(to_concat([tensor([<span class="dv">1</span>,<span class="dv">2</span>]), tensor([<span class="dv">3</span>,<span class="dv">4</span>])]), tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>test_eq(to_concat([tensor([[<span class="dv">1</span>,<span class="dv">2</span>]]), tensor([[<span class="dv">3</span>,<span class="dv">4</span>]])], dim<span class="op">=</span><span class="dv">1</span>), tensor([[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]]))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>test_eq_type(to_concat([(tensor([<span class="dv">1</span>,<span class="dv">2</span>]), tensor([<span class="dv">3</span>,<span class="dv">4</span>])), (tensor([<span class="dv">3</span>,<span class="dv">4</span>]), tensor([<span class="dv">5</span>,<span class="dv">6</span>]))]), (tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]), tensor([<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>])))</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>test_eq_type(to_concat([[tensor([<span class="dv">1</span>,<span class="dv">2</span>]), tensor([<span class="dv">3</span>,<span class="dv">4</span>])], [tensor([<span class="dv">3</span>,<span class="dv">4</span>]), tensor([<span class="dv">5</span>,<span class="dv">6</span>])]]), [tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]), tensor([<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>])])</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>test_eq_type(to_concat([(tensor([<span class="dv">1</span>,<span class="dv">2</span>]),), (tensor([<span class="dv">3</span>,<span class="dv">4</span>]),)]), (tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]),))</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>test_eq(to_concat([tensor([[<span class="dv">1</span>,<span class="dv">2</span>]]), tensor([[<span class="dv">3</span>,<span class="dv">4</span>], [<span class="dv">5</span>,<span class="dv">6</span>]])], dim<span class="op">=</span><span class="dv">1</span>), [tensor([<span class="dv">1</span>]),tensor([<span class="dv">3</span>, <span class="dv">5</span>]),tensor([<span class="dv">4</span>, <span class="dv">6</span>])])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">type</span>(to_concat([<span class="bu">dict</span>(foo<span class="op">=</span>tensor([<span class="dv">1</span>,<span class="dv">2</span>]), bar<span class="op">=</span>tensor(<span class="dv">3</span>,<span class="dv">4</span>))])), <span class="bu">dict</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="tensor-subtypes" class="level2">
<h2 class="anchored" data-anchor-id="tensor-subtypes">Tensor subtypes</h2>
<hr>
<section id="tensor.set_meta" class="level3">
<h3 class="anchored" data-anchor-id="tensor.set_meta">Tensor.set_meta</h3>
<blockquote class="blockquote">
<pre><code> Tensor.set_meta (x, as_copy=False)</code></pre>
</blockquote>
<p>Set all metadata in <code>__dict__</code></p>
<hr>
</section>
<section id="tensor.as_subclass" class="level3">
<h3 class="anchored" data-anchor-id="tensor.as_subclass">Tensor.as_subclass</h3>
<blockquote class="blockquote">
<pre><code> Tensor.as_subclass (typ)</code></pre>
</blockquote>
<p>Cast to <code>typ</code> and include <code>__dict__</code> and meta</p>
<p><code>Tensor.set_meta</code> and <code>Tensor.as_subclass</code> work together to maintain <code>__dict__</code> after casting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> _T(Tensor): <span class="cf">pass</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> tensor(<span class="fl">1.</span>).requires_grad_()</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>t.img_size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> t.as_subclass(_T)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>test_eq(t.img_size, t2.img_size)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>test_eq(t2.img_size, <span class="dv">1</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span>(t2.requires_grad_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="tensorbase" class="level3">
<h3 class="anchored" data-anchor-id="tensorbase">TensorBase</h3>
<blockquote class="blockquote">
<pre><code> TensorBase (x, **kwargs)</code></pre>
</blockquote>
<p>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</p>
<p><code>TensorBase</code> hooks into <code>__torch_function__</code> to ensure metadata is not lost. To see all functions being called, set <code>debug</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> TensorBase(<span class="dv">1</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>a.debug<span class="op">=</span><span class="va">True</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span>(a<span class="op">+</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>TensorBase(0.5000)</code></pre>
</div>
</div>
<p><code>TensorBase</code> and its subclasses also allow for passing through metadata size as img_size…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data._utils.collate <span class="im">import</span> default_collate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> TensorBase(<span class="dv">1</span>,img_size<span class="op">=</span>(<span class="dv">128</span>,<span class="dv">128</span>))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>test_eq(a.img_size,(<span class="dv">128</span>,<span class="dv">128</span>))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> cast(a,TensorBase)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>test_eq(b.img_size,(<span class="dv">128</span>,<span class="dv">128</span>))</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>test_eq(torch.stack([a,b],<span class="dv">0</span>).img_size,(<span class="dv">128</span>,<span class="dv">128</span>))</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>test_eq(default_collate([a,b]).img_size,(<span class="dv">128</span>,<span class="dv">128</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> _TImage(TensorBase): <span class="cf">pass</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> _TImage2(_TImage): <span class="cf">pass</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>t1 <span class="op">=</span> _TImage([<span class="fl">1.</span>])</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> _TImage2([<span class="fl">1.</span>])</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>t2<span class="op">+</span>t1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>_TImage2([2.])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> _T(TensorBase): <span class="cf">pass</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> _T(<span class="bu">range</span>(<span class="dv">5</span>))</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>test_eq(t[<span class="dv">0</span>], <span class="dv">0</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>test_eq_type(t<span class="op">+</span><span class="dv">1</span>, _T(<span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>)))</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">repr</span>(t), <span class="st">'_T([0, 1, 2, 3, 4])'</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>test_eq_type(t[_T([<span class="va">False</span>,<span class="va">False</span>,<span class="va">True</span>,<span class="va">True</span>,<span class="va">True</span>])], _T([<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]))</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>test_eq_type(t[_T([<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>])], _T([<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]))</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">type</span>(pickle.loads(pickle.dumps(t))), _T)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>test_eq_type(t.new_ones(<span class="dv">1</span>), _T([<span class="dv">1</span>]))</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>test_eq_type(t.new_tensor([<span class="dv">1</span>,<span class="dv">2</span>]), _T([<span class="dv">1</span>,<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> TensorBase([<span class="va">False</span>,<span class="va">True</span>,<span class="va">True</span>])</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>test_eq(t[m], tensor([<span class="dv">2</span>,<span class="dv">3</span>]))</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> tensor([[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>],[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]])</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> cast(tensor([[<span class="va">False</span>,<span class="va">True</span>,<span class="va">True</span>],</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>                 [<span class="va">False</span>,<span class="va">True</span>,<span class="va">True</span>]]), TensorBase)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>test_eq(t[m], tensor([<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> tensor([[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>],[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]])</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>t.img_size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> cast(t, TensorBase)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>test_eq(t2.img_size, t.img_size)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> retain_type(tensor([<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]), t2)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>test_eq(x.img_size, t.img_size)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>t3 <span class="op">=</span> TensorBase([[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>],[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]], img_size<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>test_eq(t3.img_size, t.img_size)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>t4 <span class="op">=</span> t2<span class="op">+</span><span class="dv">1</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>t4.img_size <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>test_eq(t2.img_size, <span class="dv">1</span>)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>test_eq(t4.img_size, <span class="dv">2</span>)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co"># this will fail with `Tensor` but works with `TensorBase`</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>test_eq(pickle.loads(pickle.dumps(t2)).img_size, t2.img_size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="tensorimagebase" class="level3">
<h3 class="anchored" data-anchor-id="tensorimagebase">TensorImageBase</h3>
<blockquote class="blockquote">
<pre><code> TensorImageBase (x, **kwargs)</code></pre>
</blockquote>
<p>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</p>
<hr>
</section>
<section id="tensorimage" class="level3">
<h3 class="anchored" data-anchor-id="tensorimage">TensorImage</h3>
<blockquote class="blockquote">
<pre><code> TensorImage (x, **kwargs)</code></pre>
</blockquote>
<p>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</p>
<hr>
</section>
<section id="tensorimagebw" class="level3">
<h3 class="anchored" data-anchor-id="tensorimagebw">TensorImageBW</h3>
<blockquote class="blockquote">
<pre><code> TensorImageBW (x, **kwargs)</code></pre>
</blockquote>
<p>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</p>
<hr>
</section>
<section id="tensormask" class="level3">
<h3 class="anchored" data-anchor-id="tensormask">TensorMask</h3>
<blockquote class="blockquote">
<pre><code> TensorMask (x, **kwargs)</code></pre>
</blockquote>
<p>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> Image.<span class="bu">open</span>(TEST_IMAGE)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>im_t <span class="op">=</span> cast(array(im), TensorImage)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">type</span>(im_t), TensorImage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>im_t2 <span class="op">=</span> cast(tensor(<span class="dv">1</span>), TensorMask)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">type</span>(im_t2), TensorMask)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>test_eq(im_t2, tensor(<span class="dv">1</span>))</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> im_t.show(figsize<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span>(im_t <span class="op">==</span> im_t2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="00_torch_core_files/figure-html/cell-81-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>test_fig_exists(ax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Operations between <code>TensorMask</code> and <code>TensorImageBase</code> objects return the type of the <code>TensorImageBase</code> object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> TensorMask([<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>test_eq_type(TensorImage(<span class="dv">1</span>)<span class="op">+</span>a, TensorImage([<span class="dv">2</span>,<span class="dv">3</span>]))</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>test_eq_type(<span class="dv">1</span><span class="op">-</span>a, TensorMask([<span class="dv">0</span>,<span class="op">-</span><span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="tensorflowfield" class="level3">
<h3 class="anchored" data-anchor-id="tensorflowfield">TensorFlowField</h3>
<blockquote class="blockquote">
<pre><code> TensorFlowField (x, **kwargs)</code></pre>
</blockquote>
<p>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="op">=</span> TensorImage([<span class="fl">1.</span>]).view(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> TensorFlowField([<span class="fl">1.</span>,<span class="fl">1.</span>]).view(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>test_eq_type(F.grid_sample(t1, t2), TensorImage([[[[<span class="fl">0.25</span>]]]]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="tensorcategory" class="level3">
<h3 class="anchored" data-anchor-id="tensorcategory">TensorCategory</h3>
<blockquote class="blockquote">
<pre><code> TensorCategory (x, **kwargs)</code></pre>
</blockquote>
<p>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>tc <span class="op">=</span> TensorCategory([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>mask_t <span class="op">=</span> TensorMask([<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>])</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>im_t <span class="op">=</span> TensorImage([<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>])</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>test_eq(mask_t[tc], tensor([<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>]))</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>test_eq(im_t[tc], tensor([<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="tensormulticategory" class="level3">
<h3 class="anchored" data-anchor-id="tensormulticategory">TensorMultiCategory</h3>
<blockquote class="blockquote">
<pre><code> TensorMultiCategory (x, **kwargs)</code></pre>
</blockquote>
<p>A <code>Tensor</code> which support subclass pickling, and maintains metadata when casting or after methods</p>
<hr>
</section>
<section id="titledtensorscalar" class="level3">
<h3 class="anchored" data-anchor-id="titledtensorscalar">TitledTensorScalar</h3>
<blockquote class="blockquote">
<pre><code> TitledTensorScalar (x, **kwargs)</code></pre>
</blockquote>
<p>A tensor containing a scalar that has a <code>show</code> method</p>
<hr>
</section>
<section id="l.cat" class="level3">
<h3 class="anchored" data-anchor-id="l.cat">L.cat</h3>
<blockquote class="blockquote">
<pre><code> L.cat (dim=0)</code></pre>
</blockquote>
<p>Same as <code>torch.cat</code></p>
<hr>
</section>
<section id="l.stack" class="level3">
<h3 class="anchored" data-anchor-id="l.stack">L.stack</h3>
<blockquote class="blockquote">
<pre><code> L.stack (dim=0)</code></pre>
</blockquote>
<p>Same as <code>torch.stack</code></p>
<hr>
</section>
<section id="l.tensored" class="level3">
<h3 class="anchored" data-anchor-id="l.tensored">L.tensored</h3>
<blockquote class="blockquote">
<pre><code> L.tensored ()</code></pre>
</blockquote>
<p><code>mapped(tensor)</code></p>
<hr>
</section>
<section id="l.tensored-1" class="level3">
<h3 class="anchored" data-anchor-id="l.tensored-1">L.tensored</h3>
<blockquote class="blockquote">
<pre><code> L.tensored ()</code></pre>
</blockquote>
<p><code>mapped(tensor)</code></p>
<p>There are shortcuts for <code>torch.stack</code> and <code>torch.cat</code> if your <code>L</code> contains tensors or something convertible. You can manually convert with <code>tensored</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> L(([<span class="dv">1</span>,<span class="dv">2</span>],[<span class="dv">3</span>,<span class="dv">4</span>]))</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>test_eq(t.tensored(), [tensor(<span class="dv">1</span>,<span class="dv">2</span>),tensor(<span class="dv">3</span>,<span class="dv">4</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="l.stack-1" class="level3">
<h3 class="anchored" data-anchor-id="l.stack-1">L.stack</h3>
<blockquote class="blockquote">
<pre><code> L.stack (dim=0)</code></pre>
</blockquote>
<p>Same as <code>torch.stack</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>test_eq(t.stack(), tensor([[<span class="dv">1</span>,<span class="dv">2</span>],[<span class="dv">3</span>,<span class="dv">4</span>]]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="l.cat-1" class="level3">
<h3 class="anchored" data-anchor-id="l.cat-1">L.cat</h3>
<blockquote class="blockquote">
<pre><code> L.cat (dim=0)</code></pre>
</blockquote>
<p>Same as <code>torch.cat</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>test_eq(t.cat(), tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="chunks" class="level2">
<h2 class="anchored" data-anchor-id="chunks">Chunks</h2>
<hr>
<section id="concat" class="level3">
<h3 class="anchored" data-anchor-id="concat">concat</h3>
<blockquote class="blockquote">
<pre><code> concat (*ls)</code></pre>
</blockquote>
<p>Concatenate tensors, arrays, lists, or tuples</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>a,b,c <span class="op">=</span> [<span class="dv">1</span>],[<span class="dv">1</span>,<span class="dv">2</span>],[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>test_eq(concat(a,b), c)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>test_eq_type(concat(<span class="bu">tuple</span> (a),<span class="bu">tuple</span> (b)), <span class="bu">tuple</span> (c))</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>test_eq_type(concat(array (a),array (b)), array (c))</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>test_eq_type(concat(tensor(a),tensor(b)), tensor(c))</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>test_eq_type(concat(TensorBase(a),TensorBase(b)), TensorBase(c))</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>test_eq_type(concat([<span class="dv">1</span>,<span class="dv">1</span>],<span class="dv">1</span>), [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>test_eq_type(concat(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), L(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>test_eq_type(concat(L(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dv">1</span>), L(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="chunks-1" class="level3">
<h3 class="anchored" data-anchor-id="chunks-1">Chunks</h3>
<blockquote class="blockquote">
<pre><code> Chunks (chunks, lens=None)</code></pre>
</blockquote>
<p>Slice and int indexing into a list of lists</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>docs <span class="op">=</span> L(<span class="bu">list</span>(string.ascii_lowercase[a:b]) <span class="cf">for</span> a,b <span class="kw">in</span> ((<span class="dv">0</span>,<span class="dv">3</span>),(<span class="dv">3</span>,<span class="dv">7</span>),(<span class="dv">7</span>,<span class="dv">8</span>),(<span class="dv">8</span>,<span class="dv">16</span>),(<span class="dv">16</span>,<span class="dv">24</span>),(<span class="dv">24</span>,<span class="dv">26</span>)))</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> Chunks(docs)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>test_eq([b[ o] <span class="cf">for</span> o <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">5</span>)], [<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span>,<span class="st">'d'</span>,<span class="st">'e'</span>])</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>test_eq([b[<span class="op">-</span>o] <span class="cf">for</span> o <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>)], [<span class="st">'z'</span>,<span class="st">'y'</span>,<span class="st">'x'</span>,<span class="st">'w'</span>,<span class="st">'v'</span>])</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>test_eq(b[<span class="dv">6</span>:<span class="dv">13</span>], <span class="st">'g,h,i,j,k,l,m'</span>.split(<span class="st">','</span>))</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>test_eq(b[<span class="dv">20</span>:<span class="dv">77</span>], <span class="st">'u,v,w,x,y,z'</span>.split(<span class="st">','</span>))</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>test_eq(b[:<span class="dv">5</span>], <span class="st">'a,b,c,d,e'</span>.split(<span class="st">','</span>))</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>test_eq(b[:<span class="dv">2</span>], <span class="st">'a,b'</span>.split(<span class="st">','</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> torch.arange(<span class="dv">26</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>docs <span class="op">=</span> L(t[a:b] <span class="cf">for</span> a,b <span class="kw">in</span> ((<span class="dv">0</span>,<span class="dv">3</span>),(<span class="dv">3</span>,<span class="dv">7</span>),(<span class="dv">7</span>,<span class="dv">8</span>),(<span class="dv">8</span>,<span class="dv">16</span>),(<span class="dv">16</span>,<span class="dv">24</span>),(<span class="dv">24</span>,<span class="dv">26</span>)))</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> Chunks(docs)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>test_eq([b[ o] <span class="cf">for</span> o <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">5</span>)], <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">5</span>))</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>test_eq([b[<span class="op">-</span>o] <span class="cf">for</span> o <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>)], [<span class="dv">25</span>,<span class="dv">24</span>,<span class="dv">23</span>,<span class="dv">22</span>,<span class="dv">21</span>])</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>test_eq(b[<span class="dv">6</span>:<span class="dv">13</span>], torch.arange(<span class="dv">6</span>,<span class="dv">13</span>))</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>test_eq(b[<span class="dv">20</span>:<span class="dv">77</span>], torch.arange(<span class="dv">20</span>,<span class="dv">26</span>))</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>test_eq(b[:<span class="dv">5</span>], torch.arange(<span class="dv">5</span>))</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>test_eq(b[:<span class="dv">2</span>], torch.arange(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>docs <span class="op">=</span> L(TensorBase(t[a:b]) <span class="cf">for</span> a,b <span class="kw">in</span> ((<span class="dv">0</span>,<span class="dv">3</span>),(<span class="dv">3</span>,<span class="dv">7</span>),(<span class="dv">7</span>,<span class="dv">8</span>),(<span class="dv">8</span>,<span class="dv">16</span>),(<span class="dv">16</span>,<span class="dv">24</span>),(<span class="dv">24</span>,<span class="dv">26</span>)))</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> Chunks(docs)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>test_eq_type(b[:<span class="dv">2</span>], TensorBase(<span class="bu">range</span>(<span class="dv">2</span>)))</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>test_eq_type(b[:<span class="dv">5</span>], TensorBase(<span class="bu">range</span>(<span class="dv">5</span>)))</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>test_eq_type(b[<span class="dv">9</span>:<span class="dv">13</span>], TensorBase(<span class="bu">range</span>(<span class="dv">9</span>,<span class="dv">13</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="simple-types" class="level2">
<h2 class="anchored" data-anchor-id="simple-types">Simple types</h2>
<hr>
<section id="show_title" class="level3">
<h3 class="anchored" data-anchor-id="show_title">show_title</h3>
<blockquote class="blockquote">
<pre><code> show_title (o, ax=None, ctx=None, label=None, color='black', **kwargs)</code></pre>
</blockquote>
<p>Set title of <code>ax</code> to <code>o</code>, or print <code>o</code> if <code>ax</code> is <code>None</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>test_stdout(<span class="kw">lambda</span>: show_title(<span class="st">"title"</span>), <span class="st">"title"</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure that col names are unique when showing to a pandas series</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> show_title(<span class="st">"title"</span>, ctx<span class="op">=</span>pd.Series(<span class="bu">dict</span>(a<span class="op">=</span><span class="dv">1</span>)), label<span class="op">=</span><span class="st">'a'</span>).equals(pd.Series(<span class="bu">dict</span>(a<span class="op">=</span><span class="dv">1</span>,a_<span class="op">=</span><span class="st">'title'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="showtitle" class="level3">
<h3 class="anchored" data-anchor-id="showtitle">ShowTitle</h3>
<blockquote class="blockquote">
<pre><code> ShowTitle ()</code></pre>
</blockquote>
<p>Base class that adds a simple <code>show</code></p>
<hr>
</section>
<section id="titledint" class="level3">
<h3 class="anchored" data-anchor-id="titledint">TitledInt</h3>
<p>An <code>int</code> with <code>show</code></p>
<hr>
</section>
<section id="titledstr" class="level3">
<h3 class="anchored" data-anchor-id="titledstr">TitledStr</h3>
<p>An <code>str</code> with <code>show</code></p>
<hr>
</section>
<section id="titledfloat" class="level3">
<h3 class="anchored" data-anchor-id="titledfloat">TitledFloat</h3>
<blockquote class="blockquote">
<pre><code> TitledFloat (x=0)</code></pre>
</blockquote>
<p>A <code>float</code> with <code>show</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>test_stdout(<span class="kw">lambda</span>: TitledStr(<span class="st">'s'</span>).show(), <span class="st">'s'</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>test_stdout(<span class="kw">lambda</span>: TitledInt(<span class="dv">1</span>).show(), <span class="st">'1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="titledtuple" class="level3">
<h3 class="anchored" data-anchor-id="titledtuple">TitledTuple</h3>
<blockquote class="blockquote">
<pre><code> TitledTuple (x=None, *rest)</code></pre>
</blockquote>
<p>A <code>fastuple</code> with <code>show</code></p>
<hr>
</section>
<section id="titledstr.truncate" class="level3">
<h3 class="anchored" data-anchor-id="titledstr.truncate">TitledStr.truncate</h3>
<blockquote class="blockquote">
<pre><code> TitledStr.truncate (n)</code></pre>
</blockquote>
<p>Truncate self to <code>n</code></p>
</section>
</section>
<section id="other-functions" class="level2">
<h2 class="anchored" data-anchor-id="other-functions">Other functions</h2>
<hr>
<section id="get_empty_df" class="level3">
<h3 class="anchored" data-anchor-id="get_empty_df">get_empty_df</h3>
<blockquote class="blockquote">
<pre><code> get_empty_df (n)</code></pre>
</blockquote>
<p>Return <code>n</code> empty rows of a dataframe</p>
<hr>
</section>
<section id="display_df" class="level3">
<h3 class="anchored" data-anchor-id="display_df">display_df</h3>
<blockquote class="blockquote">
<pre><code> display_df (df)</code></pre>
</blockquote>
<p>Display <code>df</code> in a notebook or defaults to print</p>
<hr>
</section>
<section id="get_first" class="level3">
<h3 class="anchored" data-anchor-id="get_first">get_first</h3>
<blockquote class="blockquote">
<pre><code> get_first (c)</code></pre>
</blockquote>
<p>Get the first element of c, even if c is a dataframe</p>
<hr>
</section>
<section id="one_param" class="level3">
<h3 class="anchored" data-anchor-id="one_param">one_param</h3>
<blockquote class="blockquote">
<pre><code> one_param (m)</code></pre>
</blockquote>
<p>First parameter in <code>m</code></p>
<hr>
</section>
<section id="item_find" class="level3">
<h3 class="anchored" data-anchor-id="item_find">item_find</h3>
<blockquote class="blockquote">
<pre><code> item_find (x, idx=0)</code></pre>
</blockquote>
<p>Recursively takes the <code>idx</code>-th element of <code>x</code></p>
<hr>
</section>
<section id="find_device" class="level3">
<h3 class="anchored" data-anchor-id="find_device">find_device</h3>
<blockquote class="blockquote">
<pre><code> find_device (b)</code></pre>
</blockquote>
<p>Recursively search the device of <code>b</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> to_device(tensor(<span class="dv">0</span>))</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>dev <span class="op">=</span> default_device()</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>test_eq(find_device(t2), dev)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>test_eq(find_device([t2,t2]), dev)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>test_eq(find_device({<span class="st">'a'</span>:t2,<span class="st">'b'</span>:t2}), dev)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>test_eq(find_device({<span class="st">'a'</span>:[[t2],[t2]],<span class="st">'b'</span>:t2}), dev)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="find_bs" class="level3">
<h3 class="anchored" data-anchor-id="find_bs">find_bs</h3>
<blockquote class="blockquote">
<pre><code> find_bs (b)</code></pre>
</blockquote>
<p>Recursively search the batch size of <code>b</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> torch.randn(<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>test_eq(find_bs(x1), <span class="dv">3</span>)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>test_eq(find_bs(x), <span class="dv">4</span>)</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>test_eq(find_bs((x,x)), <span class="dv">4</span>)</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>test_eq(find_bs([x, x]), <span class="dv">4</span>)</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>test_eq(find_bs({<span class="st">'a'</span>:x,<span class="st">'b'</span>:x}), <span class="dv">4</span>)</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>test_eq(find_bs({<span class="st">'a'</span>:[[x],[x]],<span class="st">'b'</span>:x}), <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="np_func" class="level3">
<h3 class="anchored" data-anchor-id="np_func">np_func</h3>
<blockquote class="blockquote">
<pre><code> np_func (f)</code></pre>
</blockquote>
<p>Convert a function taking and returning numpy arrays to one taking and returning tensors</p>
<p>This decorator is particularly useful for using numpy functions as fastai metrics, for instance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> f1_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="at">@np_func</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f1(inp,targ): <span class="cf">return</span> f1_score(targ, inp)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>a1,a2 <span class="op">=</span> array([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>]),array([<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> f1(tensor(a1),tensor(a2))</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>test_eq(f1_score(a1,a2), t)</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">isinstance</span>(t,Tensor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="module" class="level3">
<h3 class="anchored" data-anchor-id="module">Module</h3>
<blockquote class="blockquote">
<pre><code> Module ()</code></pre>
</blockquote>
<p>Same as <code>nn.Module</code>, but no need for subclasses to call <code>super().__init__</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> _T(Module):</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>): <span class="va">self</span>.f <span class="op">=</span> nn.Linear(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>,x): <span class="cf">return</span> <span class="va">self</span>.f(x)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> _T()</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>t(tensor([<span class="fl">1.</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([-0.0832], grad_fn=&lt;AddBackward0&gt;)</code></pre>
</div>
</div>
<hr>
</section>
<section id="get_model" class="level3">
<h3 class="anchored" data-anchor-id="get_model">get_model</h3>
<blockquote class="blockquote">
<pre><code> get_model (model)</code></pre>
</blockquote>
<p>Return the model maybe wrapped inside <code>model</code>.</p>
<hr>
</section>
<section id="one_hot" class="level3">
<h3 class="anchored" data-anchor-id="one_hot">one_hot</h3>
<blockquote class="blockquote">
<pre><code> one_hot (x, c)</code></pre>
</blockquote>
<p>One-hot encode <code>x</code> with <code>c</code> classes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>test_eq(one_hot([<span class="dv">1</span>,<span class="dv">4</span>], <span class="dv">5</span>), tensor(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>).byte())</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>test_eq(one_hot(torch.tensor([]), <span class="dv">5</span>), tensor(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>).byte())</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>test_eq(one_hot(<span class="dv">2</span>, <span class="dv">5</span>), tensor(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>).byte())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="one_hot_decode" class="level3">
<h3 class="anchored" data-anchor-id="one_hot_decode">one_hot_decode</h3>
<blockquote class="blockquote">
<pre><code> one_hot_decode (x, vocab=None)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>test_eq(one_hot_decode(tensor(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)), [<span class="dv">1</span>,<span class="dv">4</span>])</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>test_eq(one_hot_decode(tensor(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)), [   ])</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>test_eq(one_hot_decode(tensor(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>)), [<span class="dv">2</span>  ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="params" class="level3">
<h3 class="anchored" data-anchor-id="params">params</h3>
<blockquote class="blockquote">
<pre><code> params (m)</code></pre>
</blockquote>
<p>Return all parameters of <code>m</code></p>
<hr>
</section>
<section id="trainable_params" class="level3">
<h3 class="anchored" data-anchor-id="trainable_params">trainable_params</h3>
<blockquote class="blockquote">
<pre><code> trainable_params (m)</code></pre>
</blockquote>
<p>Return all trainable parameters of <code>m</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> nn.Linear(<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>test_eq(trainable_params(m), [m.weight, m.bias])</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>m.weight.requires_grad_(<span class="va">False</span>)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>test_eq(trainable_params(m), [m.bias])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="norm_bias_params" class="level3">
<h3 class="anchored" data-anchor-id="norm_bias_params">norm_bias_params</h3>
<blockquote class="blockquote">
<pre><code> norm_bias_params (m, with_bias=True)</code></pre>
</blockquote>
<p>Return all bias and BatchNorm parameters</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> norm_func <span class="kw">in</span> [nn.BatchNorm1d, partial(nn.InstanceNorm1d, affine<span class="op">=</span><span class="va">True</span>)]:</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> nn.Sequential(nn.Linear(<span class="dv">10</span>,<span class="dv">20</span>), norm_func(<span class="dv">20</span>), nn.Conv1d(<span class="dv">3</span>,<span class="dv">4</span>, <span class="dv">3</span>))</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>    test_eq(norm_bias_params(model), [model[<span class="dv">0</span>].bias, model[<span class="dv">1</span>].weight, model[<span class="dv">1</span>].bias, model[<span class="dv">2</span>].bias])</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> nn.ModuleList([nn.Linear(<span class="dv">10</span>,<span class="dv">20</span>, bias<span class="op">=</span><span class="va">False</span>), nn.Sequential(norm_func(<span class="dv">20</span>), nn.Conv1d(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>))])</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>    test_eq(norm_bias_params(model), [model[<span class="dv">1</span>][<span class="dv">0</span>].weight, model[<span class="dv">1</span>][<span class="dv">0</span>].bias, model[<span class="dv">1</span>][<span class="dv">1</span>].bias])</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> nn.ModuleList([nn.Linear(<span class="dv">10</span>,<span class="dv">20</span>), nn.Sequential(norm_func(<span class="dv">20</span>), nn.Conv1d(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>))])</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>    test_eq(norm_bias_params(model, with_bias<span class="op">=</span><span class="va">False</span>), [model[<span class="dv">1</span>][<span class="dv">0</span>].weight, model[<span class="dv">1</span>][<span class="dv">0</span>].bias])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="batch_to_samples" class="level3">
<h3 class="anchored" data-anchor-id="batch_to_samples">batch_to_samples</h3>
<blockquote class="blockquote">
<pre><code> batch_to_samples (b, max_n=10)</code></pre>
</blockquote>
<p>‘Transposes’ a batch to (at most <code>max_n</code>) samples</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>test_eq(batch_to_samples([t,t<span class="op">+</span><span class="dv">1</span>], max_n<span class="op">=</span><span class="dv">2</span>), ([<span class="dv">1</span>,<span class="dv">2</span>],[<span class="dv">2</span>,<span class="dv">3</span>]))</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>test_eq(batch_to_samples(tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]), <span class="dv">10</span>), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>test_eq(batch_to_samples([tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]), tensor([<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>])], <span class="dv">10</span>), [(<span class="dv">1</span>, <span class="dv">4</span>), (<span class="dv">2</span>, <span class="dv">5</span>), (<span class="dv">3</span>, <span class="dv">6</span>)])</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>test_eq(batch_to_samples([tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]), tensor([<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>])], <span class="dv">2</span>), [(<span class="dv">1</span>, <span class="dv">4</span>), (<span class="dv">2</span>, <span class="dv">5</span>)])</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>test_eq(batch_to_samples([tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]), [tensor([<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]),tensor([<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>])]], <span class="dv">10</span>), </span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>        [(<span class="dv">1</span>, (<span class="dv">4</span>, <span class="dv">7</span>)), (<span class="dv">2</span>, (<span class="dv">5</span>, <span class="dv">8</span>)), (<span class="dv">3</span>, (<span class="dv">6</span>, <span class="dv">9</span>))])</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>test_eq(batch_to_samples([tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]), [tensor([<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]),tensor([<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>])]], <span class="dv">2</span>), [(<span class="dv">1</span>, (<span class="dv">4</span>, <span class="dv">7</span>)), (<span class="dv">2</span>, (<span class="dv">5</span>, <span class="dv">8</span>))])</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> fastuple(tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]),TensorBase([<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]))</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>test_eq_type(batch_to_samples(t)[<span class="dv">0</span>][<span class="dv">1</span>], TensorBase(<span class="dv">2</span>))</span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>test_eq(batch_to_samples(t).<span class="bu">map</span>(<span class="bu">type</span>), [fastuple]<span class="op">*</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="tensor.interp_1d" class="level3">
<h3 class="anchored" data-anchor-id="tensor.interp_1d">Tensor.interp_1d</h3>
<blockquote class="blockquote">
<pre><code> Tensor.interp_1d (x:torch.Tensor, xp, fp)</code></pre>
</blockquote>
<p>Same as <code>np.interp</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>brks <span class="op">=</span> tensor(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">64</span>).<span class="bu">float</span>()</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>ys <span class="op">=</span> tensor(range_of(brks)).<span class="bu">float</span>()</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>ys <span class="op">/=</span> ys[<span class="op">-</span><span class="dv">1</span>].item()</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>pts <span class="op">=</span> tensor(<span class="fl">0.2</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">63</span>)</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> pts.interp_1d(brks, ys)</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>test_close(preds.numpy(), np.interp(pts.numpy(), brks.numpy(), ys.numpy()))</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>plt.scatter(brks,ys)</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>plt.scatter(pts,preds)</span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">'breaks'</span>,<span class="st">'preds'</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="00_torch_core_files/figure-html/cell-141-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
</section>
<section id="tensor.pca" class="level3">
<h3 class="anchored" data-anchor-id="tensor.pca">Tensor.pca</h3>
<blockquote class="blockquote">
<pre><code> Tensor.pca (x:torch.Tensor, k=2)</code></pre>
</blockquote>
<p>Compute PCA of <code>x</code> with <code>k</code> dimensions.</p>
<hr>
</section>
<section id="logit" class="level3">
<h3 class="anchored" data-anchor-id="logit">logit</h3>
<blockquote class="blockquote">
<pre><code> logit (x)</code></pre>
</blockquote>
<p>Logit of <code>x</code>, clamped to avoid inf.</p>
<hr>
</section>
<section id="num_distrib" class="level3">
<h3 class="anchored" data-anchor-id="num_distrib">num_distrib</h3>
<blockquote class="blockquote">
<pre><code> num_distrib ()</code></pre>
</blockquote>
<p>Return the number of processes in distributed training (if applicable).</p>
<hr>
</section>
<section id="rank_distrib" class="level3">
<h3 class="anchored" data-anchor-id="rank_distrib">rank_distrib</h3>
<blockquote class="blockquote">
<pre><code> rank_distrib ()</code></pre>
</blockquote>
<p>Return the distributed rank of this process (if applicable).</p>
<hr>
</section>
<section id="distrib_barrier" class="level3">
<h3 class="anchored" data-anchor-id="distrib_barrier">distrib_barrier</h3>
<blockquote class="blockquote">
<pre><code> distrib_barrier ()</code></pre>
</blockquote>
<p>Place a synchronization barrier in distributed training</p>
<p>After calling this, ALL sub-processes in the pytorch process group must arrive here before proceeding.</p>
<hr>
</section>
<section id="path.save_array" class="level3">
<h3 class="anchored" data-anchor-id="path.save_array">Path.save_array</h3>
<blockquote class="blockquote">
<pre><code> Path.save_array (p:pathlib.Path, o, complib='lz4', lvl=3)</code></pre>
</blockquote>
<p>Save numpy array to a compressed <code>pytables</code> file, using compression level <code>lvl</code></p>
<p>Compression lib can be any of: blosclz, lz4, lz4hc, snappy, zlib or zstd.</p>
<hr>
</section>
<section id="path.load_array" class="level3">
<h3 class="anchored" data-anchor-id="path.load_array">Path.load_array</h3>
<blockquote class="blockquote">
<pre><code> Path.load_array (p:pathlib.Path)</code></pre>
</blockquote>
<p>Save numpy array to a <code>pytables</code> file</p>
<hr>
</section>
<section id="base_doc" class="level3">
<h3 class="anchored" data-anchor-id="base_doc">base_doc</h3>
<blockquote class="blockquote">
<pre><code> base_doc (elt)</code></pre>
</blockquote>
<p>Print a base documentation of <code>elt</code></p>
<hr>
</section>
<section id="doc" class="level3">
<h3 class="anchored" data-anchor-id="doc">doc</h3>
<blockquote class="blockquote">
<pre><code> doc (elt)</code></pre>
</blockquote>
<p>Try to use doc form nbdev and fall back to <code>base_doc</code></p>
<hr>
</section>
<section id="nested_reorder" class="level3">
<h3 class="anchored" data-anchor-id="nested_reorder">nested_reorder</h3>
<blockquote class="blockquote">
<pre><code> nested_reorder (t, idxs)</code></pre>
</blockquote>
<p>Reorder all tensors in <code>t</code> using <code>idxs</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> tensor([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>])</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>idxs <span class="op">=</span> tensor([<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">4</span>])</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>test_eq_type(nested_reorder(([x], x), idxs), ([idxs], idxs))</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> L(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> L(i.item() <span class="cf">for</span> i <span class="kw">in</span> idxs)</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>test_eq_type(nested_reorder((y, x), idxs), (z,idxs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="flatten_check" class="level3">
<h3 class="anchored" data-anchor-id="flatten_check">flatten_check</h3>
<blockquote class="blockquote">
<pre><code> flatten_check (inp, targ)</code></pre>
</blockquote>
<p>Check that <code>out</code> and <code>targ</code> have the same number of elements and flatten them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>x1,x2 <span class="op">=</span> torch.randn(<span class="dv">5</span>,<span class="dv">4</span>),torch.randn(<span class="dv">20</span>)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>x1,x2 <span class="op">=</span> flatten_check(x1,x2)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>test_eq(x1.shape, [<span class="dv">20</span>])</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>test_eq(x2.shape, [<span class="dv">20</span>])</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>x1,x2 <span class="op">=</span> torch.randn(<span class="dv">5</span>,<span class="dv">4</span>),torch.randn(<span class="dv">21</span>)</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>test_fail(<span class="kw">lambda</span>: flatten_check(x1,x2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="image-helpers" class="level2">
<h2 class="anchored" data-anchor-id="image-helpers">Image helpers</h2>
<hr>
<section id="make_cross_image" class="level3">
<h3 class="anchored" data-anchor-id="make_cross_image">make_cross_image</h3>
<blockquote class="blockquote">
<pre><code> make_cross_image (bw=True)</code></pre>
</blockquote>
<p>Create a tensor containing a cross image, either <code>bw</code> (True) or color</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(make_cross_image(), cmap<span class="op">=</span><span class="st">"Greys"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="00_torch_core_files/figure-html/cell-156-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(make_cross_image(<span class="va">False</span>).permute(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">0</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="00_torch_core_files/figure-html/cell-157-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
</section>
<section id="show_image_batch" class="level3">
<h3 class="anchored" data-anchor-id="show_image_batch">show_image_batch</h3>
<blockquote class="blockquote">
<pre><code> show_image_batch (b, show=&lt;function show_titled_image&gt;, items=9, cols=3,
                   figsize=None, **kwargs)</code></pre>
</blockquote>
<p>Display batch <code>b</code> in a grid of size <code>items</code> with <code>cols</code> width</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>show_image_batch(([Image.<span class="bu">open</span>(TEST_IMAGE_BW),Image.<span class="bu">open</span>(TEST_IMAGE)],[<span class="st">'bw'</span>,<span class="st">'color'</span>]), items<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="00_torch_core_files/figure-html/cell-159-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="model-init" class="level2">
<h2 class="anchored" data-anchor-id="model-init">Model init</h2>
<hr>
<section id="requires_grad" class="level3">
<h3 class="anchored" data-anchor-id="requires_grad">requires_grad</h3>
<blockquote class="blockquote">
<pre><code> requires_grad (m)</code></pre>
</blockquote>
<p>Check if the first parameter of <code>m</code> requires grad or not</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>tst <span class="op">=</span> nn.Linear(<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> requires_grad(tst)</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> tst.parameters(): p.requires_grad_(<span class="va">False</span>)</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="kw">not</span> requires_grad(tst)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="init_default" class="level3">
<h3 class="anchored" data-anchor-id="init_default">init_default</h3>
<blockquote class="blockquote">
<pre><code> init_default (m, func=&lt;function kaiming_normal_&gt;)</code></pre>
</blockquote>
<p>Initialize <code>m</code> weights with <code>func</code> and set <code>bias</code> to 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>tst <span class="op">=</span> nn.Linear(<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>tst.weight.data.uniform_(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>tst.bias.data.uniform_(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>tst <span class="op">=</span> init_default(tst, func <span class="op">=</span> <span class="kw">lambda</span> x: x.data.fill_(<span class="fl">1.</span>))</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>test_eq(tst.weight, torch.ones(<span class="dv">5</span>,<span class="dv">4</span>))</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>test_eq(tst.bias, torch.zeros(<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="cond_init" class="level3">
<h3 class="anchored" data-anchor-id="cond_init">cond_init</h3>
<blockquote class="blockquote">
<pre><code> cond_init (m, func)</code></pre>
</blockquote>
<p>Apply <code>init_default</code> to <code>m</code> unless it’s a batchnorm module</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>tst <span class="op">=</span> nn.Linear(<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>tst.weight.data.uniform_(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>tst.bias.data.uniform_(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>cond_init(tst, func <span class="op">=</span> <span class="kw">lambda</span> x: x.data.fill_(<span class="fl">1.</span>))</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>test_eq(tst.weight, torch.ones(<span class="dv">5</span>,<span class="dv">4</span>))</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>test_eq(tst.bias, torch.zeros(<span class="dv">5</span>))</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>tst <span class="op">=</span> nn.BatchNorm2d(<span class="dv">5</span>)</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>init <span class="op">=</span> [tst.weight.clone(), tst.bias.clone()]</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>cond_init(tst, func <span class="op">=</span> <span class="kw">lambda</span> x: x.data.fill_(<span class="fl">1.</span>))</span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>test_eq(tst.weight, init[<span class="dv">0</span>])</span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>test_eq(tst.bias, init[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="apply_leaf" class="level3">
<h3 class="anchored" data-anchor-id="apply_leaf">apply_leaf</h3>
<blockquote class="blockquote">
<pre><code> apply_leaf (m, f)</code></pre>
</blockquote>
<p>Apply <code>f</code> to children of <code>m</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>tst <span class="op">=</span> nn.Sequential(nn.Linear(<span class="dv">4</span>,<span class="dv">5</span>), nn.Sequential(nn.Linear(<span class="dv">4</span>,<span class="dv">5</span>), nn.Linear(<span class="dv">4</span>,<span class="dv">5</span>)))</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>apply_leaf(tst, partial(init_default, func<span class="op">=</span><span class="kw">lambda</span> x: x.data.fill_(<span class="fl">1.</span>)))</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> [tst[<span class="dv">0</span>], <span class="op">*</span>tst[<span class="dv">1</span>]]: test_eq(l.weight, torch.ones(<span class="dv">5</span>,<span class="dv">4</span>))</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> [tst[<span class="dv">0</span>], <span class="op">*</span>tst[<span class="dv">1</span>]]: test_eq(l.bias,   torch.zeros(<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="apply_init" class="level3">
<h3 class="anchored" data-anchor-id="apply_init">apply_init</h3>
<blockquote class="blockquote">
<pre><code> apply_init (m, func=&lt;function kaiming_normal_&gt;)</code></pre>
</blockquote>
<p>Initialize all non-batchnorm layers of <code>m</code> with <code>func</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>tst <span class="op">=</span> nn.Sequential(nn.Linear(<span class="dv">4</span>,<span class="dv">5</span>), nn.Sequential(nn.Linear(<span class="dv">4</span>,<span class="dv">5</span>), nn.BatchNorm1d(<span class="dv">5</span>)))</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>init <span class="op">=</span> [tst[<span class="dv">1</span>][<span class="dv">1</span>].weight.clone(), tst[<span class="dv">1</span>][<span class="dv">1</span>].bias.clone()]</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>apply_init(tst, func<span class="op">=</span><span class="kw">lambda</span> x: x.data.fill_(<span class="fl">1.</span>))</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> [tst[<span class="dv">0</span>], tst[<span class="dv">1</span>][<span class="dv">0</span>]]: test_eq(l.weight, torch.ones(<span class="dv">5</span>,<span class="dv">4</span>))</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> [tst[<span class="dv">0</span>], tst[<span class="dv">1</span>][<span class="dv">0</span>]]: test_eq(l.bias,   torch.zeros(<span class="dv">5</span>))</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>test_eq(tst[<span class="dv">1</span>][<span class="dv">1</span>].weight, init[<span class="dv">0</span>])</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>test_eq(tst[<span class="dv">1</span>][<span class="dv">1</span>].bias,   init[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="autograd-jit-functions" class="level2">
<h2 class="anchored" data-anchor-id="autograd-jit-functions">autograd jit functions</h2>
<hr>
<section id="script_use_ctx" class="level3">
<h3 class="anchored" data-anchor-id="script_use_ctx">script_use_ctx</h3>
<blockquote class="blockquote">
<pre><code> script_use_ctx (f)</code></pre>
</blockquote>
<p>Decorator: create jit script and pass everything in <code>ctx.saved_variables to</code>f<code>, after</code>*args`</p>
<hr>
</section>
<section id="script_save_ctx" class="level3">
<h3 class="anchored" data-anchor-id="script_save_ctx">script_save_ctx</h3>
<blockquote class="blockquote">
<pre><code> script_save_ctx (static, *argidx)</code></pre>
</blockquote>
<p>Decorator: create jit script and save args with indices <code>argidx</code> using <code>ctx.save_for_backward</code></p>
<hr>
</section>
<section id="script_fwd" class="level3">
<h3 class="anchored" data-anchor-id="script_fwd">script_fwd</h3>
<blockquote class="blockquote">
<pre><code> script_fwd (*argidx)</code></pre>
</blockquote>
<p>Decorator: create static jit script and save args with indices <code>argidx</code> using <code>ctx.save_for_backward</code></p>
<hr>
</section>
<section id="script_bwd" class="level3">
<h3 class="anchored" data-anchor-id="script_bwd">script_bwd</h3>
<blockquote class="blockquote">
<pre><code> script_bwd (f)</code></pre>
</blockquote>
<p>Decorator: create static jit script and pass everything in <code>ctx.saved_variables to</code>f<code>, after</code>*args`</p>
<hr>
</section>
<section id="grad_module" class="level3">
<h3 class="anchored" data-anchor-id="grad_module">grad_module</h3>
<blockquote class="blockquote">
<pre><code> grad_module (cls)</code></pre>
</blockquote>
<p>Decorator: convert <code>cls</code> into an autograd function</p>
<hr>
</section>
<section id="ismin_torch" class="level3">
<h3 class="anchored" data-anchor-id="ismin_torch">ismin_torch</h3>
<blockquote class="blockquote">
<pre><code> ismin_torch (min_version)</code></pre>
</blockquote>
<p>Check if <code>torch.__version__</code> &gt;= <code>min_version</code> using packaging.version</p>
<hr>
</section>
<section id="notmax_torch" class="level3">
<h3 class="anchored" data-anchor-id="notmax_torch">notmax_torch</h3>
<blockquote class="blockquote">
<pre><code> notmax_torch (max_version)</code></pre>
</blockquote>
<p>Check if <code>torch.__version__</code> &lt; <code>max_version</code> using packaging.version</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>