---

title: Loop


keywords: fastai
sidebar: home_sidebar

summary: "fastrl concept of generic loop objects. "
description: "fastrl concept of generic loop objects. "
nb_path: "nbs/02_fastai.loop.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_fastai.loop.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Why-do-we-need-this?">Why do we need this?<a class="anchor-link" href="#Why-do-we-need-this?"> </a></h3><p>We have identified at least 3 different kinds of loops already:</p>

<pre><code>Learner (training)
Source/Gym (Data Access)
Agent (How an AI takes in data, generates actions)

</code></pre>
<h3 id="What-is-a-loop?">What is a loop?<a class="anchor-link" href="#What-is-a-loop?"> </a></h3>
<pre><code>It should be capable of containing inner loops. 
It should self-describe its structure. 
It should be easy to know which parts of the loop are taking long/short amounts of time.
It should be flexible in state modification.
It should alternatively make it easy show what fields are being changed at what points in time.</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A Loop will act as a compiled structure. The actual result will be a compiled list of nodes that reference the original loop.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="EventException" class="doc_header"><code>class</code> <code>EventException</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L33" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>EventException</code>() :: <code>Exception</code></p>
</blockquote>
<p>Common base class for all non-exit exceptions.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="event_parent_iter" class="doc_header"><code>event_parent_iter</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L35" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>event_parent_iter</code>(<strong><code>event</code></strong>:<a href="/fastrl/fastai.loop.html#Event"><code>Event</code></a>)</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>event</code></strong> : <em><code>Event</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="custom_traceback" class="doc_header"><code>custom_traceback</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L329" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>custom_traceback</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Event" class="doc_header"><code>class</code> <code>Event</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L45" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Event</code>(<strong><code>function</code></strong>:<code>Callable</code>, <strong><code>loop</code></strong>=<em><code>None</code></em>, <strong><code>parent_event</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>function</code></strong> : <em><code>typing.Callable</code></em></p>
</li>
<li><p><strong><code>loop</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>parent_event</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="isrelevent" class="doc_header"><code>isrelevent</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L102" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>isrelevent</code>(<strong><code>loop_or_cb</code></strong>, <strong><code>event</code></strong>:<a href="/fastrl/fastai.loop.html#Event"><code>Event</code></a>)</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>loop_or_cb</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
<li><p><strong><code>event</code></strong> : <em><code>&lt;class 'fastrl.fastai.loop.Event'&gt;</code></em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">on_test</span><span class="p">():</span><span class="k">pass</span>

<span class="n">decorated_on_test</span><span class="o">=</span><span class="n">Event</span><span class="p">(</span><span class="n">on_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">decorated_on_test</span><span class="o">.</span><span class="n">full_name</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;__main__.on_test&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">B</span><span class="p">():</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">on_test_2_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">B</span><span class="o">.</span><span class="n">on_test_2_a</span><span class="o">.</span><span class="n">full_name</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;__main__.B.on_test_2_a&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">loop</span><span class="p">,</span><span class="n">root_loop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">events</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">instantiate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">loop</span><span class="o">=</span><span class="n">instance</span> <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="bp">cls</span><span class="p">()</span> <span class="k">if</span> <span class="n">instantiate</span> <span class="k">else</span> <span class="bp">cls</span><span class="p">)</span>
        <span class="n">events</span><span class="o">=</span><span class="n">L</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_last_element</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">_is_event</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">loop</span><span class="o">=</span><span class="n">loop</span>
        <span class="k">return</span> <span class="n">events</span>
    
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">before_test_c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before_test_c&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">on_test_c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_test_c&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">after_test_c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after_test_c&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">after_test_c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after_test_c&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">on_test_b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_test_b&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">on_test_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_test_a&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A</span><span class="p">()</span><span class="o">.</span><span class="n">before_test_c</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>before_test_c
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notes:</p>
<ul>
<li>Having a section object might make this overal loop management better<ul>
<li>remaining stuff, the Section object needs to handle lists and execute those also.</li>
<li>with this in mind, using the section I think will make the looping run much cleaner.</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SectionException" class="doc_header"><code>class</code> <code>SectionException</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L135" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SectionException</code>() :: <code>Exception</code></p>
</blockquote>
<p>Common base class for all non-exit exceptions.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Section" class="doc_header"><code>class</code> <code>Section</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L137" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Section</code>(<strong><code>events</code></strong>, <strong><code>parent_event</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>events</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
<li><p><strong><code>parent_event</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Section</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">events</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">events</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;before_&#39;: __main__.A.before_test_c,
 &#39;before_inner&#39;: [],
 &#39;on_&#39;: __main__.A.on_test_c,
 &#39;on_inner&#39;: [],
 &#39;after_&#39;: __main__.A.after_test_c,
 &#39;after_inner&#39;: [],
 &#39;failed_&#39;: &lt;function __main__._default_raise()&gt;,
 &#39;failed_inner&#39;: [],
 &#39;finally_&#39;: &lt;function fastcore.imports.noop(x=None, *args, **kwargs)&gt;,
 &#39;finally_inner&#39;: []}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A</span><span class="o">.</span><span class="n">events</span><span class="p">(</span><span class="n">A</span><span class="p">())[</span><span class="mi">0</span><span class="p">]()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>after_test_c
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> 
    <span class="n">n_events</span><span class="o">=</span>      <span class="kc">True</span><span class="p">,</span>
    <span class="n">include_events</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">n_cbs</span><span class="o">=</span>         <span class="kc">True</span><span class="p">,</span>
    <span class="n">include_cbs</span><span class="o">=</span>   <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">Section</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">events</span><span class="p">(</span><span class="n">A</span><span class="p">()))]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;Section 3 events\n\t__main__.A.before_test_c\n\t__main__.A.on_test_c\n\t__main__.A.after_test_c&#39;,
 &#39;Section 1 events\n\t__main__.A.on_test_a&#39;,
 &#39;Section 1 events\n\t__main__.A.on_test_b&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> 
    <span class="n">n_events</span><span class="o">=</span>      <span class="kc">True</span><span class="p">,</span>
    <span class="n">include_events</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">n_cbs</span><span class="o">=</span>         <span class="kc">True</span><span class="p">,</span>
    <span class="n">include_cbs</span><span class="o">=</span>   <span class="kc">True</span><span class="p">))</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">Section</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">events</span><span class="p">(</span><span class="n">A</span><span class="p">()))]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Section 3 events
	__main__.A.before_test_c
	__main__.A.on_test_c
	__main__.A.after_test_c
Section 1 events
	__main__.A.on_test_a
Section 1 events
	__main__.A.on_test_b
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[None, None, None]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">Section</span><span class="o">.</span><span class="n">from_events</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">events</span><span class="p">(</span><span class="n">A</span><span class="p">()))]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>before_test_c
on_test_c
after_test_c
on_test_a
on_test_b
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[None, None, None]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="classmethod.__func__" class="doc_header"><code>classmethod.__func__</code><a href="" class="source_link" style="float:right">[source]</a></h4>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Loop" class="doc_header"><code>class</code> <code>Loop</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L216" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Loop</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Outer</span><span class="p">(</span><span class="n">Loop</span><span class="p">):</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">before_step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before_step&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">on_step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>     <span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_step&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">after_step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after_step&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">failed_step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;failed_step&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">finally_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;finally_step&#39;</span><span class="p">)</span>
 
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">before_jump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before_jump&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">on_jump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>     <span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_jump&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">after_jump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after_jump&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">failed_jump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;failed_jump&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">finally_jump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;finally_jump&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Inner</span><span class="p">(</span><span class="n">Loop</span><span class="p">):</span>
    <span class="n">call_on</span><span class="o">=</span><span class="n">L</span><span class="p">(</span><span class="n">Outer</span><span class="o">.</span><span class="n">on_step</span><span class="p">,</span><span class="n">Outer</span><span class="o">.</span><span class="n">after_step</span><span class="p">,</span><span class="n">Outer</span><span class="o">.</span><span class="n">finally_jump</span><span class="p">)</span>
    
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">before_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before_iteration&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">on_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>     <span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_iteration&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">after_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after_iteration&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">failed_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;failed_iteration&#39;</span><span class="p">)</span>
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">finally_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;finally_iteration&#39;</span><span class="p">)</span>
    <span class="c1"># def run(self,loops=None,cbs=None):</span>
    <span class="c1">#     sections=self.get_sections(loops=loops,cbs=cbs)</span>
    <span class="c1">#     for section in sections:</span>
    <span class="c1">#         section.run()</span>
    
<span class="k">class</span> <span class="nc">FailingInner</span><span class="p">(</span><span class="n">Loop</span><span class="p">):</span>
    <span class="n">call_on</span><span class="o">=</span><span class="n">L</span><span class="p">(</span><span class="n">Inner</span><span class="o">.</span><span class="n">finally_iteration</span><span class="p">)</span>
    
    <span class="nd">@event</span>
    <span class="k">def</span> <span class="nf">on_force_fail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                    
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_force_fail&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span>
        
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Outer</span><span class="p">()</span><span class="o">.</span><span class="n">get_sections</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="n">Inner</span><span class="p">(),</span><span class="n">FailingInner</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Section, Section]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CallbackException" class="doc_header"><code>class</code> <code>CallbackException</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L276" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CallbackException</code>() :: <code>Exception</code></p>
</blockquote>
<p>Common base class for all non-exit exceptions.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Callback" class="doc_header"><code>class</code> <code>Callback</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L278" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Callback</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OuterCallback</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
    <span class="n">call_on</span><span class="o">=</span><span class="n">L</span><span class="p">(</span><span class="n">Outer</span><span class="o">.</span><span class="n">on_step</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">before_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">(</span><span class="n">this</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span><span class="n">that</span><span class="o">=</span><span class="nb">str</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   OuterCallback called lol&#39;</span><span class="p">)</span>

<span class="n">Outer</span><span class="p">()</span><span class="o">.</span><span class="n">get_sections</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="n">Inner</span><span class="p">(),</span><span class="n">FailingInner</span><span class="p">()),</span><span class="n">OuterCallback</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Section, Section]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Outer</span><span class="o">.</span><span class="n">from_sections</span><span class="p">(</span>
    <span class="n">loops</span><span class="o">=</span><span class="n">L</span><span class="p">(</span><span class="n">Inner</span><span class="p">(),</span><span class="n">FailingInner</span><span class="p">()),</span>
    <span class="n">cbs</span><span class="o">=</span><span class="n">OuterCallback</span>
                   
                   
<span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
    <span class="n">n_sections</span><span class="o">=</span>      <span class="kc">True</span><span class="p">,</span>
    <span class="n">include_sections</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">n_events</span><span class="o">=</span>        <span class="kc">True</span><span class="p">,</span>
    <span class="n">include_events</span><span class="o">=</span>  <span class="kc">True</span><span class="p">,</span>
    <span class="n">n_cbs</span><span class="o">=</span>           <span class="kc">True</span><span class="p">,</span>
    <span class="n">include_cbs</span><span class="o">=</span>     <span class="kc">True</span><span class="p">,</span>
    <span class="n">include_defaults</span><span class="o">=</span><span class="kc">True</span>
<span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Outer 2 sections
  Section 5 events
      __main__.Outer.before_step
      __main__.Outer.on_step
      Inner 1 sections
          Section 5 events
              __main__.Inner.before_iteration
              __main__.Inner.on_iteration
              __main__.Inner.after_iteration
              __main__.Inner.failed_iteration
              __main__.Inner.finally_iteration
              FailingInner 1 sections
                  Section 1 events
            &lt;function noop at 0x7f6ec82035e0&gt;
                      __main__.FailingInner.on_force_fail
            &lt;function noop at 0x7f6ec82035e0&gt;
            &lt;function _default_raise at 0x7f6e91bfe3a0&gt;
            &lt;function noop at 0x7f6ec82035e0&gt;
      __main__.Outer.after_step
      Inner 1 sections
          Section 5 events
              __main__.Inner.before_iteration
              __main__.Inner.on_iteration
              __main__.Inner.after_iteration
              __main__.Inner.failed_iteration
              __main__.Inner.finally_iteration
              FailingInner 1 sections
                  Section 1 events
            &lt;function noop at 0x7f6ec82035e0&gt;
                      __main__.FailingInner.on_force_fail
            &lt;function noop at 0x7f6ec82035e0&gt;
            &lt;function _default_raise at 0x7f6e91bfe3a0&gt;
            &lt;function noop at 0x7f6ec82035e0&gt;
      __main__.Outer.failed_step
      __main__.Outer.finally_step
  Section 5 events
      __main__.Outer.before_jump
      __main__.Outer.on_jump
      __main__.Outer.after_jump
      __main__.Outer.failed_jump
      __main__.Outer.finally_jump
      Inner 1 sections
          Section 5 events
              __main__.Inner.before_iteration
              __main__.Inner.on_iteration
              __main__.Inner.after_iteration
              __main__.Inner.failed_iteration
              __main__.Inner.finally_iteration
              FailingInner 1 sections
                  Section 1 events
            &lt;function noop at 0x7f6ec82035e0&gt;
                      __main__.FailingInner.on_force_fail
            &lt;function noop at 0x7f6ec82035e0&gt;
            &lt;function _default_raise at 0x7f6e91bfe3a0&gt;
            &lt;function noop at 0x7f6ec82035e0&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="callers_module" class="doc_header"><code>callers_module</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L301" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>callers_module</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_mycode" class="doc_header"><code>is_mycode</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L305" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_mycode</code>(<strong><code>tb</code></strong>)</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>tb</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mycode_traceback_levels" class="doc_header"><code>mycode_traceback_levels</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L311" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mycode_traceback_levels</code>(<strong><code>tb</code></strong>)</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>tb</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="handle_exception" class="doc_header"><code>handle_exception</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L318" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>handle_exception</code>(<strong><code>type</code></strong>, <strong><code>value</code></strong>, <strong><code>tb</code></strong>)</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>type</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
<li><p><strong><code>value</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
<li><p><strong><code>tb</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="custom_traceback" class="doc_header"><code>custom_traceback</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/fastai/loop.py#L329" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>custom_traceback</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">Outer</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="n">Inner</span><span class="p">(),</span><span class="n">FailingInner</span><span class="p">()),</span><span class="n">OuterCallback</span><span class="p">())</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">exception_info</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;this shouldnt show&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>before_step
on_step
before_iteration
on_iteration
after_iteration
finally_iteration
on_force_fail
adding render traceback
failed_step
finally_step
(&lt;class &#39;Exception&#39;&gt;, Exception(), &lt;traceback object at 0x7f6e91c429c0&gt;)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
Traceback (most recent call last):

  File &#34;/home/fastrl_user/.local/lib/python3.8/site-packages/IPython/core/interactiveshell.py&#34;, line 3444, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)

  File &#34;/tmp/ipykernel_123/1736314016.py&#34;, line 2, in &lt;module&gt;
    Outer().run(L(Inner(),FailingInner()),OuterCallback())

  File &#34;/tmp/ipykernel_123/58164693.py&#34;, line 55, in run
    section.run()

  File &#34;/tmp/ipykernel_123/2529393489.py&#34;, line 76, in run
    for o in self.events[&#39;on_inner&#39;]: o.run()

  File &#34;/tmp/ipykernel_123/58164693.py&#34;, line 55, in run
    section.run()

  File &#34;/tmp/ipykernel_123/2529393489.py&#34;, line 87, in run
    for o in self.events[&#39;finally_inner&#39;]: o.run()

  File &#34;/tmp/ipykernel_123/58164693.py&#34;, line 55, in run
    section.run()

  File &#34;/tmp/ipykernel_123/2529393489.py&#34;, line 81, in run
    self.events[&#39;failed_&#39;]()

  File &#34;/tmp/ipykernel_123/2529393489.py&#34;, line 75, in run
    self.events[&#39;on_&#39;]()

  File &#34;/tmp/ipykernel_123/1171587323.py&#34;, line 50, in __call__
    ret=self.function(self.loop,*args,**kwargs)

  File &#34;/tmp/ipykernel_123/3821596272.py&#34;, line 48, in on_force_fail
    raise Exception

Exception
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Outer().get_sections(L(Inner(),FailingInner()),OuterCallback)[0].events[&#39;on_inner&#39;][0].sections[0].run()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

