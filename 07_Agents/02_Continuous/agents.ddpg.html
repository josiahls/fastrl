<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Deep Deterministic Policy Gradiant for continuous action domains">

<title>fastrl - DDPG</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
        <script type="text/javascript">
        window.PlotlyConfig = {MathJaxConfig: 'local'};
        if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
        if (typeof require !== 'undefined') {
        require.undef("plotly");
        requirejs.config({
            paths: {
                'plotly': ['https://cdn.plot.ly/plotly-2.14.0.min']
            }
        });
        require(['plotly'], function(Plotly) {
            window._Plotly = Plotly;
        });
        }
        </script>
        

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="fastrl - DDPG">
<meta property="og:description" content="Deep Deterministic Policy Gradiant for continuous action domains">
<meta property="og:site-name" content="fastrl">
<meta name="twitter:title" content="fastrl - DDPG">
<meta name="twitter:description" content="Deep Deterministic Policy Gradiant for continuous action domains">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">fastrl</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">DDPG</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">fastrl</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../core.html" class="sidebar-item-text sidebar-link">Core</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../nbdev_extension.html" class="sidebar-item-text sidebar-link">Nbdev Extensions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cli.html" class="sidebar-item-text sidebar-link">CLI</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../test_utils.html" class="sidebar-item-text sidebar-link">Synth Agent</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Fastai</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../00_Fastai/torch_core.html" class="sidebar-item-text sidebar-link">Torch Core</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">DataPipes</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_DataPipes/pipes.core.html" class="sidebar-item-text sidebar-link">Pipes Core</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_DataPipes/pipes.map.demux.html" class="sidebar-item-text sidebar-link">DeMultiplexer</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_DataPipes/pipes.map.mux.html" class="sidebar-item-text sidebar-link">Multiplexer</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_DataPipes/pipes.iter.nskip.html" class="sidebar-item-text sidebar-link">NSkip</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_DataPipes/pipes.iter.nstep.html" class="sidebar-item-text sidebar-link">NStep</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_DataPipes/pipes.iter.firstlast.html" class="sidebar-item-text sidebar-link">FirstLast</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_DataPipes/pipes.iter.transforms.html" class="sidebar-item-text sidebar-link">Item and Batch Transforms</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01_DataPipes/pipes.map.transforms.html" class="sidebar-item-text sidebar-link">Type Transforms</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">DataLoading</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../02_DataLoading/data.dataloader2.html" class="sidebar-item-text sidebar-link">DataLoader2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../02_DataLoading/data.block.html" class="sidebar-item-text sidebar-link">Data Block</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Environment</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03_Environment/envs.gym.html" class="sidebar-item-text sidebar-link">Envs Gym</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Memory</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../04_Memory/memory.experience_replay.html" class="sidebar-item-text sidebar-link">Experience Replay</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Logging</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../05_Logging/loggers.core.html" class="sidebar-item-text sidebar-link">Loggers Core</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../05_Logging/loggers.jupyter_visualizers.html" class="sidebar-item-text sidebar-link">Visualizers</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../05_Logging/loggers.tensorboard.html" class="sidebar-item-text sidebar-link">Tensorboard</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../05_Logging/loggers.vscode_visualizers.html" class="sidebar-item-text sidebar-link">Visualizers - VS-Code</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">Learning</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../06_Learning/learner.core.html" class="sidebar-item-text sidebar-link">Learner Core</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">Agents</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../07_Agents/agents.core.html" class="sidebar-item-text sidebar-link">Agent Core</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">Discrete</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../07_Agents/01_Discrete/agents.discrete.html" class="sidebar-item-text sidebar-link">Agent Discrete</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../07_Agents/01_Discrete/agents.dqn.basic.html" class="sidebar-item-text sidebar-link">DQN Basic</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../07_Agents/01_Discrete/agents.dqn.target.html" class="sidebar-item-text sidebar-link">DQN Target</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../07_Agents/01_Discrete/agents.dqn.asynchronous.html" class="sidebar-item-text sidebar-link">DQN Async</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../07_Agents/01_Discrete/agents.dqn.double.html" class="sidebar-item-text sidebar-link">DQN Double</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../07_Agents/01_Discrete/agents.dqn.dueling.html" class="sidebar-item-text sidebar-link">DQN Dueling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../07_Agents/01_Discrete/agents.dqn.categorical.html" class="sidebar-item-text sidebar-link">Categorical DQN</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../07_Agents/01_Discrete/agents.dqn.rainbow.html" class="sidebar-item-text sidebar-link">DQN Rainbow</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">Continuous</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../07_Agents/02_Continuous/agents.ddpg.html" class="sidebar-item-text sidebar-link active">DDPG</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">FAQ</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../08_FAQ/99_notes.multi_proc.html" class="sidebar-item-text sidebar-link">MultiProcessing Notes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../08_FAQ/notes.pipe_insertion.html" class="sidebar-item-text sidebar-link">TorchData DataPipe Notes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../08_FAQ/notes.speed.html" class="sidebar-item-text sidebar-link">Speed</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../08_FAQ/template.html" class="sidebar-item-text sidebar-link">Template</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#model" id="toc-model" class="nav-link active" data-scroll-target="#model">Model</a>
  <ul class="collapse">
  <li><a href="#init_xavier_uniform_weights" id="toc-init_xavier_uniform_weights" class="nav-link" data-scroll-target="#init_xavier_uniform_weights">init_xavier_uniform_weights</a></li>
  <li><a href="#init_uniform_weights" id="toc-init_uniform_weights" class="nav-link" data-scroll-target="#init_uniform_weights">init_uniform_weights</a></li>
  <li><a href="#init_kaiming_normal_weights" id="toc-init_kaiming_normal_weights" class="nav-link" data-scroll-target="#init_kaiming_normal_weights">init_kaiming_normal_weights</a></li>
  <li><a href="#ddpg_conv2d_block" id="toc-ddpg_conv2d_block" class="nav-link" data-scroll-target="#ddpg_conv2d_block">ddpg_conv2d_block</a></li>
  <li><a href="#critic" id="toc-critic" class="nav-link" data-scroll-target="#critic">Critic</a></li>
  <li><a href="#actor" id="toc-actor" class="nav-link" data-scroll-target="#actor">Actor</a></li>
  <li><a href="#pipe_to_device" id="toc-pipe_to_device" class="nav-link" data-scroll-target="#pipe_to_device">pipe_to_device</a></li>
  </ul></li>
  <li><a href="#ornstein-uhlenbeck-exploration" id="toc-ornstein-uhlenbeck-exploration" class="nav-link" data-scroll-target="#ornstein-uhlenbeck-exploration">Ornstein-Uhlenbeck Exploration</a>
  <ul class="collapse">
  <li><a href="#ornsteinuhlenbeck" id="toc-ornsteinuhlenbeck" class="nav-link" data-scroll-target="#ornsteinuhlenbeck">OrnsteinUhlenbeck</a></li>
  <li><a href="#explorationcomparisonlogger" id="toc-explorationcomparisonlogger" class="nav-link" data-scroll-target="#explorationcomparisonlogger">ExplorationComparisonLogger</a></li>
  </ul></li>
  <li><a href="#agent" id="toc-agent" class="nav-link" data-scroll-target="#agent">Agent</a>
  <ul class="collapse">
  <li><a href="#actionunbatcher" id="toc-actionunbatcher" class="nav-link" data-scroll-target="#actionunbatcher">ActionUnbatcher</a></li>
  <li><a href="#actionclip" id="toc-actionclip" class="nav-link" data-scroll-target="#actionclip">ActionClip</a></li>
  <li><a href="#ddpgagent" id="toc-ddpgagent" class="nav-link" data-scroll-target="#ddpgagent">DDPGAgent</a></li>
  </ul></li>
  <li><a href="#learner" id="toc-learner" class="nav-link" data-scroll-target="#learner">Learner</a>
  <ul class="collapse">
  <li><a href="#basicoptstepper" id="toc-basicoptstepper" class="nav-link" data-scroll-target="#basicoptstepper">BasicOptStepper</a></li>
  <li><a href="#losscollector" id="toc-losscollector" class="nav-link" data-scroll-target="#losscollector">LossCollector</a></li>
  <li><a href="#softtargetupdater" id="toc-softtargetupdater" class="nav-link" data-scroll-target="#softtargetupdater">SoftTargetUpdater</a></li>
  <li><a href="#get_target_model" id="toc-get_target_model" class="nav-link" data-scroll-target="#get_target_model">get_target_model</a></li>
  <li><a href="#criticlossprocessor" id="toc-criticlossprocessor" class="nav-link" data-scroll-target="#criticlossprocessor">CriticLossProcessor</a></li>
  <li><a href="#actorlossprocessor" id="toc-actorlossprocessor" class="nav-link" data-scroll-target="#actorlossprocessor">ActorLossProcessor</a></li>
  <li><a href="#ddpglearner" id="toc-ddpglearner" class="nav-link" data-scroll-target="#ddpglearner">DDPGLearner</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/josiahls/fastrl/tree/main/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">DDPG</h1>
</div>

<div>
  <div class="description">
    Deep Deterministic Policy Gradiant for continuous action domains
  </div>
</div>


<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p><a href="https://arxiv.org/abs/1509.02971">(Lillicrap et al., 2016) [DDPG] Continuous Control with Deep Reinforcement Learning</a> based on the DPG algorithm in <a href="http://proceedings.mlr.press/v32/silver14.pdf">(Silver et al., 2014) [DPG] Deterministic Policy Gradient Algorithms</a>.</p>
<p>DDPG uses an actor-critic architecture and has a similar training / learning paradym to DQNs.</p>
<p>Below is <code>(Lillicrap et al., 2016) Algorithm 1</code> that summarizes DDPG.</p>
<p><img src="../../images/(Lilicrap et al., 2016) DDPG Algorithm 1.png" width="947" height="694"></p>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<hr>
<section id="init_xavier_uniform_weights" class="level3">
<h3 class="anchored" data-anchor-id="init_xavier_uniform_weights">init_xavier_uniform_weights</h3>
<blockquote class="blockquote">
<pre><code> init_xavier_uniform_weights (m:fastrl.torch_core.Module, bias=0.01)</code></pre>
</blockquote>
<p>Initializes weights for linear layers using <code>torch.nn.init.xavier_uniform_</code></p>
<hr>
</section>
<section id="init_uniform_weights" class="level3">
<h3 class="anchored" data-anchor-id="init_uniform_weights">init_uniform_weights</h3>
<blockquote class="blockquote">
<pre><code> init_uniform_weights (m:fastrl.torch_core.Module, bound)</code></pre>
</blockquote>
<p>Initializes weights for linear layers using <code>torch.nn.init.uniform_</code></p>
<hr>
</section>
<section id="init_kaiming_normal_weights" class="level3">
<h3 class="anchored" data-anchor-id="init_kaiming_normal_weights">init_kaiming_normal_weights</h3>
<blockquote class="blockquote">
<pre><code> init_kaiming_normal_weights (m:fastrl.torch_core.Module, bias=0.01)</code></pre>
</blockquote>
<p>Initializes weights for linear layers using <code>torch.nn.init.kaiming_normal_</code></p>
<p><code>Lilicrap et al., 2016</code> pg 11 notes: “The other layers were initialized from uniform distributions <span class="math inline">\([ \frac{-1}{\sqrt{f}},\frac{1}{\sqrt{f}}]\)</span> where f is the fan-in of the layer.”</p>
<p><code>init_kaiming_normal_weights</code> is the most similar to this strategy. Other implimentations of DDPGs have also used <code>init_xavier_uniform_weights</code></p>
<blockquote class="blockquote">
<p>Note: There does not appear to be a major difference between performance of using either.</p>
</blockquote>
<p>The same page notes: “final layer weights and biases of both the actor and critic were initialized from a uniform distribution <span class="math inline">\([−3 * 10^{−3}, 3 * 10^{−3}]\)</span> and <span class="math inline">\([3 * 10^{−4}, 3 * 10^{−4}]\)</span> for the low dimensional and pixel cases respectively.”, so the default value for <code>final_layer_init_fn</code> uses <code>init_uniform_weights</code> with a bound of <code>1e-4</code> for low dim, and if pixels, needs to be changed to <code>1e-5</code>.</p>
<p>The same page notes: “The low-dimensional networks had 2 hidden layers with 400 and 300 units respectively … When learning from pixels we used 3 convolutional layers (no pooling) with 32 filters at each layer. This was followed by two fully connected layers with 200 units”</p>
<p>We default to expect low-dimensions, and for images we will augment this.</p>
<hr>
</section>
<section id="ddpg_conv2d_block" class="level3">
<h3 class="anchored" data-anchor-id="ddpg_conv2d_block">ddpg_conv2d_block</h3>
<blockquote class="blockquote">
<pre><code> ddpg_conv2d_block (state_sz:Tuple[int,int,int], filters=32,
                    activation_fn=&lt;class
                    'torch.nn.modules.activation.ReLU'&gt;,
                    ignore_warning:bool=False)</code></pre>
</blockquote>
<p>Creates a 3 layer conv block from <code>state_sz</code> along with expected n_feature output shape.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>state_sz</td>
<td>typing.Tuple[int, int, int]</td>
<td></td>
<td>A tuple of state sizes generally representing an image of format: <br>[channel,width,height]</td>
</tr>
<tr class="even">
<td>filters</td>
<td>int</td>
<td>32</td>
<td>Number of filters to use for each conv layer</td>
</tr>
<tr class="odd">
<td>activation_fn</td>
<td>type</td>
<td>ReLU</td>
<td>Activation function between each layer.</td>
</tr>
<tr class="even">
<td>ignore_warning</td>
<td>bool</td>
<td>False</td>
<td>We assume the channels dim should be size 3 max. If it is more<br>we assume the width/height are in the location of channel and need to<br>be transposed.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>typing.Tuple[torch.nn.modules.container.Sequential, int]</strong></td>
<td></td>
<td><strong>(Convolutional block,n_features_out)</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ddpg_conv2d_block((<span class="dv">3</span>,<span class="dv">100</span>,<span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(Sequential(
   (0): BatchNorm2d(3, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
   (1): Conv2d(3, 3, kernel_size=(32, 32), stride=(1, 1))
   (2): ReLU()
   (3): Conv2d(3, 3, kernel_size=(32, 32), stride=(1, 1))
   (4): ReLU()
   (5): Conv2d(3, 3, kernel_size=(32, 32), stride=(1, 1))
   (6): Flatten(start_dim=1, end_dim=-1)
 ),
 147)</code></pre>
</div>
</div>
<hr>
</section>
<section id="critic" class="level3">
<h3 class="anchored" data-anchor-id="critic">Critic</h3>
<blockquote class="blockquote">
<pre><code> Critic (state_sz:int, action_sz:int, hidden1:int=400, hidden2:int=300,
         head_layer:fastrl.torch_core.Module=&lt;class
         'torch.nn.modules.linear.Linear'&gt;,
         activation_fn:fastrl.torch_core.Module=&lt;class
         'torch.nn.modules.activation.ReLU'&gt;,
         weight_init_fn:Callable=&lt;function init_kaiming_normal_weights&gt;,
         final_layer_init_fn:Callable=functools.partial(&lt;function
         init_uniform_weights at 0x7f75db31ef80&gt;, bound=0.0001), conv_bloc
         k:Union[torch.nn.modules.container.Sequential,NoneType]=None,
         batch_norm:bool=False)</code></pre>
</blockquote>
<p>Takes a 2 tensors of size [B,<code>state_sz</code>], [B,<code>action_sz</code>] -&gt; [B,1] outputs a 1d tensor representing the Q value</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>state_sz</td>
<td>int</td>
<td></td>
<td>The input dim of the state / flattened conv output</td>
</tr>
<tr class="even">
<td>action_sz</td>
<td>int</td>
<td></td>
<td>The input dim of the actions</td>
</tr>
<tr class="odd">
<td>hidden1</td>
<td>int</td>
<td>400</td>
<td>Number of neurons connected between the 2 input/output layers</td>
</tr>
<tr class="even">
<td>hidden2</td>
<td>int</td>
<td>300</td>
<td>Number of neurons connected between the 2 input/output layers</td>
</tr>
<tr class="odd">
<td>head_layer</td>
<td>Module</td>
<td>Linear</td>
<td>Output layer</td>
</tr>
<tr class="even">
<td>activation_fn</td>
<td>Module</td>
<td>ReLU</td>
<td>The activation function</td>
</tr>
<tr class="odd">
<td>weight_init_fn</td>
<td>typing.Callable</td>
<td>init_kaiming_normal_weights</td>
<td>The weight initialization strategy</td>
</tr>
<tr class="even">
<td>final_layer_init_fn</td>
<td>typing.Callable</td>
<td>functools.partial(&lt;function init_uniform_weights at 0x7f75db31ef80&gt;, bound=0.0001)</td>
<td>Final layer initialization strategy</td>
</tr>
<tr class="odd">
<td>conv_block</td>
<td>typing.Union[torch.nn.modules.container.Sequential, NoneType]</td>
<td>None</td>
<td>For pixel inputs, we can plug in a <code>nn.Sequential</code> block from <code>ddpg_conv2d_block</code>.<br>This means that actions will be feed into the second linear layer instead of the <br>first.</td>
</tr>
<tr class="even">
<td>batch_norm</td>
<td>bool</td>
<td>False</td>
<td>Whether to do batch norm.</td>
</tr>
</tbody>
</table>
<p>The <code>Critic</code> is used by <code>DDPG</code> to estimate the Q value of state-action pairs and is updated using the the Bellman-Equation similarly to DQN/Q-Learning and is represeted by <span class="math inline">\(Q(s,a)\)</span></p>
<p>Check that low dim input works…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">0</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>critic <span class="op">=</span> Critic(<span class="dv">4</span>,<span class="dv">2</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> torch.randn(<span class="dv">1</span>,<span class="dv">4</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>action <span class="op">=</span> torch.randn(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad(),evaluating(critic):</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    test_eq(</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">str</span>(critic(state,action)),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">str</span>(tensor([[<span class="fl">0.0083</span>]]))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check that image input works…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">0</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>image_shape <span class="op">=</span> (<span class="dv">3</span>,<span class="dv">100</span>,<span class="dv">100</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>conv_block,feature_out <span class="op">=</span> ddpg_conv2d_block(image_shape)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>critic <span class="op">=</span> Critic(feature_out,<span class="dv">2</span>,conv_block<span class="op">=</span>conv_block)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> torch.randn(<span class="dv">1</span>,<span class="op">*</span>image_shape)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>action <span class="op">=</span> torch.randn(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad(),evaluating(critic):</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    test_eq(</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">str</span>(critic(state,action)),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">str</span>(tensor([[<span class="fl">0.0102</span>]]))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="actor" class="level3">
<h3 class="anchored" data-anchor-id="actor">Actor</h3>
<blockquote class="blockquote">
<pre><code> Actor (state_sz:int, action_sz:int, hidden1:int=400, hidden2:int=300,
        head_layer:fastrl.torch_core.Module=&lt;class
        'torch.nn.modules.linear.Linear'&gt;,
        activation_fn:fastrl.torch_core.Module=&lt;class
        'torch.nn.modules.activation.ReLU'&gt;,
        weight_init_fn:Callable=&lt;function init_kaiming_normal_weights&gt;,
        final_layer_init_fn:Callable=functools.partial(&lt;function
        init_uniform_weights at 0x7f75db31ef80&gt;, bound=0.0001), conv_block
        :Union[torch.nn.modules.container.Sequential,NoneType]=None,
        batch_norm:bool=False)</code></pre>
</blockquote>
<p>Takes a single tensor of size [B,<code>state_sz</code>] -&gt; [B,<code>action_sz</code>] and outputs a tensor of actions.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>state_sz</td>
<td>int</td>
<td></td>
<td>The input dim of the state</td>
</tr>
<tr class="even">
<td>action_sz</td>
<td>int</td>
<td></td>
<td>The output dim of the actions</td>
</tr>
<tr class="odd">
<td>hidden1</td>
<td>int</td>
<td>400</td>
<td>Number of neurons connected between the 2 input/output layers</td>
</tr>
<tr class="even">
<td>hidden2</td>
<td>int</td>
<td>300</td>
<td>Number of neurons connected between the 2 input/output layers</td>
</tr>
<tr class="odd">
<td>head_layer</td>
<td>Module</td>
<td>Linear</td>
<td>Output layer</td>
</tr>
<tr class="even">
<td>activation_fn</td>
<td>Module</td>
<td>ReLU</td>
<td>The activiation function</td>
</tr>
<tr class="odd">
<td>weight_init_fn</td>
<td>typing.Callable</td>
<td>init_kaiming_normal_weights</td>
<td>The weight initialization strategy</td>
</tr>
<tr class="even">
<td>final_layer_init_fn</td>
<td>typing.Callable</td>
<td>functools.partial(&lt;function init_uniform_weights at 0x7f75db31ef80&gt;, bound=0.0001)</td>
<td>Final layer initialization strategy</td>
</tr>
<tr class="odd">
<td>conv_block</td>
<td>typing.Union[torch.nn.modules.container.Sequential, NoneType]</td>
<td>None</td>
<td>For pixel inputs, we can plug in a <code>nn.Sequential</code> block from <code>ddpg_conv2d_block</code>.</td>
</tr>
<tr class="even">
<td>batch_norm</td>
<td>bool</td>
<td>False</td>
<td>Whether to do batch norm.</td>
</tr>
</tbody>
</table>
<p>The <code>Actor</code> is used by <code>DDPG</code> to predict actions based on state inputs and is represeted by <span class="math inline">\(\mu(s|\theta^\mu)\)</span></p>
<p>Check that low dim input works…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">0</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>actor <span class="op">=</span> Actor(<span class="dv">4</span>,<span class="dv">2</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> torch.randn(<span class="dv">1</span>,<span class="dv">4</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad(),evaluating(actor):</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    test_eq(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">str</span>(actor(state)),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">str</span>(tensor([[<span class="fl">0.0101</span>, <span class="fl">0.0083</span>]]))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check that image input works…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">0</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>image_shape <span class="op">=</span> (<span class="dv">3</span>,<span class="dv">100</span>,<span class="dv">100</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>conv_block,feature_out <span class="op">=</span> ddpg_conv2d_block(image_shape)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>actor <span class="op">=</span> Actor(feature_out,<span class="dv">2</span>,conv_block<span class="op">=</span>conv_block)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> torch.randn(<span class="dv">1</span>,<span class="op">*</span>image_shape)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>action <span class="op">=</span> torch.randn(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad(),evaluating(actor):</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    test_eq(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">str</span>(actor(state)),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">str</span>(tensor([[<span class="fl">0.0100</span>, <span class="fl">0.0100</span>]]))</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="pipe_to_device" class="level3">
<h3 class="anchored" data-anchor-id="pipe_to_device">pipe_to_device</h3>
<blockquote class="blockquote">
<pre><code> pipe_to_device (pipe, device, debug=False)</code></pre>
</blockquote>
<p>Attempt to move an entire <code>pipe</code> and its pipeline to <code>device</code></p>
</section>
</section>
<section id="ornstein-uhlenbeck-exploration" class="level2">
<h2 class="anchored" data-anchor-id="ornstein-uhlenbeck-exploration">Ornstein-Uhlenbeck Exploration</h2>
<hr>
<section id="ornsteinuhlenbeck" class="level3">
<h3 class="anchored" data-anchor-id="ornsteinuhlenbeck">OrnsteinUhlenbeck</h3>
<blockquote class="blockquote">
<pre><code> OrnsteinUhlenbeck (*args, **kwds)</code></pre>
</blockquote>
<p>Used for exploration in continuous action domains via temporaly correlated noise.</p>
<p>[1] From https://math.stackexchange.com/questions/1287634/implementing-ornstein-uhlenbeck-in-matlab</p>
<p>[2] Cumulatively based on <a href="http://www.entsphere.com/pub/pdf/1930%20Uhlenbeck,%20on%20the%20theory%20of%20the%20Brownian%20motion.pdf">Uhlenbeck et al., 1930</a></p>
<p>The <code>OrnsteinUhlenbeck</code> for DDPG has natation:</p>
<p><span class="math inline">\(\mu'(s_t)=\mu(s_t|\theta_{t}^{\mu}) + N\)</span></p>
<blockquote class="blockquote">
<p>Note: (Lilicrap et al., 2016) pg 4 says “generate temporally correlated exploration for exploration efficiency in physical control problems with inertia”. This might be important to consider when training on environments that don’t require inertia.</p>
</blockquote>
<hr>
</section>
<section id="explorationcomparisonlogger" class="level3">
<h3 class="anchored" data-anchor-id="explorationcomparisonlogger">ExplorationComparisonLogger</h3>
<blockquote class="blockquote">
<pre><code> ExplorationComparisonLogger (*args, **kwds)</code></pre>
</blockquote>
<p>Allows for quickly doing a “what if” on exploration methods by comparing the actions selected via exploration with the ones chosen by the model.</p>
<p>Below we demonstrate that the exploration works. As the number of steps increase, epsilon will decrease to zero, and so the actions slowly become more deterministic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">0</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>actions <span class="op">=</span> dp.<span class="bu">iter</span>.IterableWrapper(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Batch of 4 actions with dimensions 2</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    torch.randn(<span class="dv">4</span>,<span class="dv">2</span>).to(device<span class="op">=</span>default_device())</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>actions <span class="op">=</span> OrnsteinUhlenbeck(</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    actions,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    min_epsilon<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    max_steps<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    action_sz<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    decrement_on_val<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    explore_on_val<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    ret_original<span class="op">=</span><span class="va">True</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>actions.to(device<span class="op">=</span>default_device())</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>actions <span class="op">=</span> actions.cycle(count<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>actions <span class="op">=</span> ExplorationComparisonLogger(actions)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(actions)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>actions.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="07310f30-d47f-4317-8f07-62d4e7e58349" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("07310f30-d47f-4317-8f07-62d4e7e58349")) {                    Plotly.newPlot(                        "07310f30-d47f-4317-8f07-62d4e7e58349",                        [{"hovertemplate":"variable=0<br>N Steps=%{x}<br>Difference between Original/Explored Action=%{y}<extra></extra>","legendgroup":"0","marker":{"color":"#636efa","symbol":"circle"},"mode":"markers","name":"0","orientation":"v","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199],"xaxis":"x","y":[0.6617422103881836,0.5954577922821045,1.0047699213027954,0.9186293482780457,0.7095434665679932,0.6425290107727051,0.39498192071914673,0.38031595945358276,0.09337055683135986,0.24856102466583252,0.10852450132369995,0.1344306468963623,0.2885706424713135,0.10237431526184082,0.19361114501953125,0.05008426308631897,0.1501171588897705,0.27062439918518066,0.2170889973640442,0.35487228631973267,0.09571540355682373,0.2283111810684204,0.06264197826385498,0.07810038328170776,0.21326327323913574,0.04579949378967285,0.05398356914520264,0.15893465280532837,0.08662831783294678,0.3136420249938965,0.06814467906951904,0.053789377212524414,0.14241981506347656,0.14854097366333008,0.24536705017089844,0.2319965809583664,0.24139404296875,0.20495223999023438,0.10840332508087158,0.13123327493667603,0.07241654396057129,0.07916736602783203,0.1887131929397583,0.13617455959320068,0.07606267929077148,0.03487229347229004,0.332413911819458,0.3982648551464081,0.3440150022506714,0.04008364677429199,0.25600528717041016,0.06574547290802002,0.06428098678588867,0.027538061141967773,0.0008918046951293945,0.19349829852581024,0.012349724769592285,0.13827991485595703,0.06156182289123535,0.06087017059326172,0.2264270782470703,0.5039925575256348,0.32718169689178467,0.6238589286804199,0.4270141124725342,0.34148740768432617,0.3002002239227295,0.21041184663772583,0.3205409049987793,0.15642213821411133,0.024324774742126465,0.00949057936668396,0.05446338653564453,0.21584439277648926,0.3561667203903198,0.15375497937202454,0.10136842727661133,0.008484363555908203,0.12020313739776611,0.3332785665988922,0.3328949213027954,0.2856414318084717,0.35019755363464355,0.39532649517059326,0.3637427091598511,0.19896411895751953,0.2815474271774292,0.15816780924797058,0.04899179935455322,0.0012788772583007812,0.1520845890045166,0.04943805932998657,0.1969447135925293,0.08762264251708984,0.07550883293151855,0.038605719804763794,0.08431291580200195,0.07904839515686035,0.14501875638961792,0.155800461769104,0.06346309185028076,0.07056736946105957,0.05742955207824707,0.12600457668304443,0.21094775199890137,0.09391403198242188,0.31717395782470703,0.26379626989364624,0.10733294486999512,0.15933561325073242,0.13341832160949707,0.13425129652023315,0.06996965408325195,0.12247586250305176,0.18862783908843994,0.20591053366661072,0.2356170415878296,0.20376896858215332,0.21294057369232178,0.27207812666893005,0.0843193531036377,0.18941092491149902,0.0426868200302124,0.022732466459274292,0.06289982795715332,0.08977055549621582,0.048868536949157715,0.0011896193027496338,0.03756678104400635,0.017440319061279297,0.07178044319152832,0.13294583559036255,0.06842339038848877,0.08387041091918945,0.044040799140930176,0.08244416117668152,0.08688700199127197,0.12690234184265137,0.0724252462387085,0.0435333251953125,0.0811166763305664,0.022887706756591797,0.04304075241088867,0.040692418813705444,0.019047021865844727,0.01337742805480957,0.08174765110015869,0.04006066918373108,0.004046440124511719,0.05133795738220215,0.029938936233520508,0.048068881034851074,0.03309130668640137,0.01117396354675293,0.10493636131286621,0.1014103889465332,0.16115427017211914,0.11389017105102539,0.17809271812438965,0.10084491968154907,0.09003949165344238,0.047415971755981445,0.037456631660461426,0.022985339164733887,0.055831193923950195,0.07248640060424805,0.10293173789978027,0.07168987393379211,0.10044705867767334,0.08869266510009766,0.06440484523773193,0.06396526098251343,0.06664752960205078,0.07076740264892578,0.027568459510803223,0.040809571743011475,0.05678880214691162,0.04393720626831055,0.027777433395385742,0.03307560086250305,0.028299927711486816,0.011356353759765625,0.025838375091552734,0.020795226097106934,0.017039775848388672,0.0024614334106445312,0.006945252418518066,0.003953009843826294,0.0015693902969360352,0.0014872550964355469,0.002728581428527832,0.010966360569000244,0.002742290496826172,0.0029439926147460938,0.007701516151428223,0.006058424711227417,0.0019588470458984375,0.0016515254974365234,0.000712275505065918,0.0],"yaxis":"y","type":"scatter"},{"hovertemplate":"variable=1<br>N Steps=%{x}<br>Difference between Original/Explored Action=%{y}<extra></extra>","legendgroup":"1","marker":{"color":"#EF553B","symbol":"circle"},"mode":"markers","name":"1","orientation":"v","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199],"xaxis":"x","y":[0.7611064910888672,0.5343414545059204,0.31077563762664795,0.014941215515136719,0.1096944808959961,0.19640111923217773,0.47013533115386963,0.5044233202934265,0.4664734899997711,0.304740309715271,0.3522834777832031,0.0479046106338501,0.20828521251678467,0.33500340580940247,0.3063305616378784,0.1048843264579773,0.07537341117858887,0.22188448905944824,0.14002001285552979,0.3600277304649353,0.3237682282924652,0.42132484912872314,0.037702083587646484,0.10946202278137207,0.2611694931983948,0.38938331604003906,0.4193190336227417,0.1580439805984497,0.32151535153388977,0.04034113883972168,0.11282408237457275,0.2726084589958191,0.30429667234420776,0.09735512733459473,0.039734840393066406,0.1610819697380066,0.30915772914886475,0.49447089433670044,0.4169095754623413,0.7575050592422485,0.7672325372695923,0.4474440813064575,0.2876567840576172,0.48071080446243286,0.5171499252319336,0.4327581822872162,0.4326540231704712,0.5651969909667969,0.5773385763168335,0.2841360867023468,0.24318194389343262,0.011881113052368164,0.08361062407493591,0.26832711696624756,0.33827006816864014,0.4032275080680847,0.5747033953666687,0.40900474786758423,0.15134239196777344,0.5402960181236267,0.3754780888557434,0.19490593671798706,0.007592558860778809,0.1385541558265686,0.0786142349243164,0.2590487003326416,0.2103102207183838,0.11165386438369751,0.058214202523231506,0.10732477903366089,0.09988844394683838,0.0510517954826355,0.061592161655426025,0.050492167472839355,0.10909008979797363,0.2096673846244812,0.06579740345478058,0.0336114764213562,0.004770040512084961,0.22862082719802856,0.2039441019296646,0.30773359537124634,0.17673194408416748,0.2473035454750061,0.19667068123817444,0.1319800615310669,0.1116647720336914,0.3185165524482727,0.1710594892501831,0.1800004243850708,0.27985596656799316,0.3109554648399353,0.3528832793235779,0.3393930196762085,0.22757947444915771,0.3380693793296814,0.3894939720630646,0.3127206563949585,0.2101360559463501,0.13434356451034546,0.044726014137268066,0.10837668180465698,0.21461772918701172,0.1667647361755371,0.04771190881729126,0.06716620922088623,0.06251895427703857,0.005728483200073242,0.07382677495479584,0.059592247009277344,0.16096746921539307,0.1938799023628235,0.2188902348279953,0.06727677583694458,0.1427314281463623,0.23434072732925415,0.2371891736984253,0.17080068588256836,0.08498775959014893,0.11499369144439697,0.0927899181842804,0.03557109832763672,0.08612370491027832,0.0778922438621521,0.1905478835105896,0.13356250524520874,0.15132975578308105,0.1394774317741394,0.16595590114593506,0.13145214319229126,0.20805418491363525,0.1314677596092224,0.1013604998588562,0.01299363374710083,0.03751671314239502,0.047263145446777344,0.06370300054550171,0.0631818175315857,0.0423353910446167,0.01108473539352417,0.03682643175125122,0.05106770992279053,0.06052827835083008,0.03365480899810791,0.06172674894332886,0.050444841384887695,0.013032197952270508,0.04093736410140991,0.0098935067653656,6.9141387939453125e-06,0.07957315444946289,0.11667728424072266,0.11209797859191895,0.0191459059715271,0.006043434143066406,0.019471704959869385,0.012468099594116211,0.0389823317527771,0.012485146522521973,0.04317516088485718,0.05661441385746002,0.07497966289520264,0.0616832971572876,0.11195838451385498,0.06406442821025848,0.10141026973724365,0.05792808532714844,0.05453050136566162,0.006317734718322754,0.015895545482635498,0.07032787799835205,0.005308330059051514,0.00927552580833435,0.017526447772979736,0.016985535621643066,0.002314746379852295,0.030901670455932617,0.023712575435638428,0.06028091907501221,0.06016993522644043,0.02969259023666382,0.016369521617889404,0.0002683401107788086,0.007833540439605713,0.014816105365753174,0.0004127025604248047,0.0097121000289917,0.00011777877807617188,0.014774948358535767,0.005845546722412109,0.01082909107208252,0.0027590394020080566,0.0006875395774841309,0.0020704269409179688,0.0021021366119384766,0.00015181303024291992,0.005374610424041748,0.004890143871307373,0.0023157596588134766,0.0],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"N Steps"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Difference between Original/Explored Action"}},"legend":{"title":{"text":"variable"},"tracegroupgap":0},"title":{"text":"Explored Actions vs Original Actions"}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('07310f30-d47f-4317-8f07-62d4e7e58349');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
</section>
</section>
<section id="agent" class="level2">
<h2 class="anchored" data-anchor-id="agent">Agent</h2>
<hr>
<section id="actionunbatcher" class="level3">
<h3 class="anchored" data-anchor-id="actionunbatcher">ActionUnbatcher</h3>
<blockquote class="blockquote">
<pre><code> ActionUnbatcher (*args, **kwds)</code></pre>
</blockquote>
<p>Removes the batch dim from an action.</p>
<hr>
</section>
<section id="actionclip" class="level3">
<h3 class="anchored" data-anchor-id="actionclip">ActionClip</h3>
<blockquote class="blockquote">
<pre><code> ActionClip (*args, **kwds)</code></pre>
</blockquote>
<p>Restricts actions from <code>source_datapipe</code> between <code>clip_min</code> and <code>clip_max</code></p>
<p>Interally calls <code>torch.clip</code></p>
<hr>
</section>
<section id="ddpgagent" class="level3">
<h3 class="anchored" data-anchor-id="ddpgagent">DDPGAgent</h3>
<blockquote class="blockquote">
<pre><code> DDPGAgent (model:__main__.Actor,
            logger_bases:Union[fastrl.loggers.core.LoggerBase,NoneType]=No
            ne, min_epsilon:float=0.2, max_epsilon:float=1,
            max_steps:int=100, dp_augmentation_fns:Union[List[fastrl.pipes
            .core.DataPipeAugmentationFn],NoneType]=None)</code></pre>
</blockquote>
<p>Produces continuous action outputs.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>model</td>
<td>Actor</td>
<td></td>
<td>The actor to use for mapping states to actions</td>
</tr>
<tr class="even">
<td>logger_bases</td>
<td>typing.Union[fastrl.loggers.core.LoggerBase, NoneType]</td>
<td>None</td>
<td>LoggerBases push logs to. If None, logs will be collected and output<br>by the dataloader.</td>
</tr>
<tr class="odd">
<td>min_epsilon</td>
<td>float</td>
<td>0.2</td>
<td>The minimum epsilon to drop to</td>
</tr>
<tr class="even">
<td>max_epsilon</td>
<td>float</td>
<td>1</td>
<td>The max/starting epsilon if <code>epsilon</code> is None and used for calculating epislon decrease speed.</td>
</tr>
<tr class="odd">
<td>max_steps</td>
<td>int</td>
<td>100</td>
<td>Determines how fast the episilon should drop to <code>min_epsilon</code>. This should be the number<br>of steps that the agent was run through.</td>
</tr>
<tr class="even">
<td>dp_augmentation_fns</td>
<td>typing.Union[typing.List[fastrl.pipes.core.DataPipeAugmentationFn], NoneType]</td>
<td>None</td>
<td>Any augmentations to the DDPG agent.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>AgentHead</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Check that given a <code>step</code>, we can get actions from the <code>DDPGAgent</code>…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">0</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>actor <span class="op">=</span> Actor(<span class="dv">4</span>,<span class="dv">2</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>agent <span class="op">=</span> DDPGAgent(actor)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>input_tensor <span class="op">=</span> tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]).<span class="bu">float</span>()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>step <span class="op">=</span> SimpleStep(state<span class="op">=</span>input_tensor)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> action <span class="kw">in</span> agent([step]):</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(action)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.91868794 0.7928086 ]
[0.89038295 1.        ]
[0.59973884 0.5640401 ]
[0.8244315 0.6234891]
[0.6276505  0.41781008]
[0.59242374 0.68170094]
[0.339647   0.42176256]
[0.5469213  0.11551299]
[ 0.34022635 -0.23093009]
[ 0.33037645 -0.13671152]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastrl.envs.gym <span class="im">import</span> GymTransformBlock</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastrl.loggers.vscode_visualizers <span class="im">import</span> VSCodeTransformBlock</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="learner" class="level2">
<h2 class="anchored" data-anchor-id="learner">Learner</h2>
<hr>
<section id="basicoptstepper" class="level3">
<h3 class="anchored" data-anchor-id="basicoptstepper">BasicOptStepper</h3>
<blockquote class="blockquote">
<pre><code> BasicOptStepper (*args, **kwds)</code></pre>
</blockquote>
<p>Optimizes <code>model</code> using <code>opt</code>. <code>source_datapipe</code> must produce a dictionary of format: <code>{"loss":...}</code>, otherwise all non-dicts will be passed through.</p>
<hr>
</section>
<section id="losscollector" class="level3">
<h3 class="anchored" data-anchor-id="losscollector">LossCollector</h3>
<blockquote class="blockquote">
<pre><code> LossCollector (*args, **kwds)</code></pre>
</blockquote>
<p>Itercepts dictionary results generated from <code>source_datapipe</code> that are in the format: <code>{'loss':tensor(...)}</code>. All other elements will be ignored and passed through.</p>
<p>If <code>filter=true</code>, then intercepted dictionaries will filtered out by this pipe, and will not be propagated to the rest of the pipeline.</p>
<hr>
</section>
<section id="softtargetupdater" class="level3">
<h3 class="anchored" data-anchor-id="softtargetupdater">SoftTargetUpdater</h3>
<blockquote class="blockquote">
<pre><code> SoftTargetUpdater (*args, **kwds)</code></pre>
</blockquote>
<p>Soft-Copies <code>model</code> to a <code>target_model</code> (internal) every <code>target_sync</code> batches.</p>
<p>We use <code>SoftTargetUpdater</code> to update the target <code>Critic</code> and <code>Actor</code>. This is characterized by the notation:</p>
<p><span class="math display">\[
\theta^{Q'} \leftarrow \tau \theta^Q + (1 - \tau)\theta^{Q'}
\]</span> <span class="math display">\[
\theta^{\mu'} \leftarrow \tau \theta^\mu + (1 - \tau)\theta^{\mu'}
\]</span></p>
<p>For both the <code>Critic</code>(Q) and <code>Actor</code>(<span class="math inline">\(\mu\)</span>) are slowly copied to their targets based on the value <span class="math inline">\(\tau\)</span></p>
<hr>
</section>
<section id="get_target_model" class="level3">
<h3 class="anchored" data-anchor-id="get_target_model">get_target_model</h3>
<blockquote class="blockquote">
<pre><code> get_target_model (model:Union[torch.nn.modules.module.Module,NoneType], p
                   ipe:Union[torch.utils.data.datapipes.datapipe.IterDataP
                   ipe,torch.utils.data.datapipes.datapipe.MapDataPipe],
                   model_cls:torch.nn.modules.module.Module, target_update
                   r_cls:Tuple[Union[torch.utils.data.datapipes.datapipe.I
                   terDataPipe,torch.utils.data.datapipes.datapipe.MapData
                   Pipe]]=(&lt;class '__main__.SoftTargetUpdater'&gt;,),
                   debug:bool=False)</code></pre>
</blockquote>
<p>Basic utility for getting the ‘target’ version of <code>model_cls</code> in <code>pipe</code></p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>model</td>
<td>typing.Union[torch.nn.modules.module.Module, NoneType]</td>
<td></td>
<td>If <code>model</code> is not none, then we assume it to be the target model<br>and simply return it, otherwise we search for a <code>target_model</code></td>
</tr>
<tr class="even">
<td>pipe</td>
<td>typing.Union[torch.utils.data.datapipes.datapipe.IterDataPipe, torch.utils.data.datapipes.datapipe.MapDataPipe]</td>
<td></td>
<td>The pipe to start search along</td>
</tr>
<tr class="odd">
<td>model_cls</td>
<td>Module</td>
<td></td>
<td>The class of the model we are looking for</td>
</tr>
<tr class="even">
<td>target_updater_cls</td>
<td>typing.Tuple[typing.Union[torch.utils.data.datapipes.datapipe.IterDataPipe, torch.utils.data.datapipes.datapipe.MapDataPipe]]</td>
<td>(&lt;class ‘<strong>main</strong>.SoftTargetUpdater’&gt;,)</td>
<td>A tuple of datapipes that have a field called <code>target_model</code>.<br><code>get_target_model</code> will look for these in <code>pipe</code></td>
</tr>
<tr class="odd">
<td>debug</td>
<td>bool</td>
<td>False</td>
<td>Verbose output</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="criticlossprocessor" class="level3">
<h3 class="anchored" data-anchor-id="criticlossprocessor">CriticLossProcessor</h3>
<blockquote class="blockquote">
<pre><code> CriticLossProcessor (*args, **kwds)</code></pre>
</blockquote>
<p>Produces a critic loss based on <code>critic</code>,<code>t_actor</code>,<code>t_critic</code> and batch <code>StepTypes</code> from <code>source_datapipe</code> where the targets and predictions are fed into <code>loss</code>.</p>
<p>This datapipe produces either Dict[Literal[‘loss’],torch.Tensor] or <code>SimpleStep</code>.</p>
<p>From (Lilicrap et al., 2016), we expect to get N transitions from <span class="math inline">\(R\)</span> where <span class="math inline">\(R\)</span> is <code>source_datapipe</code>.</p>
<p><span class="math inline">\(N\)</span> transitions <span class="math inline">\((s_i, a_i, r_i, s_{i+1})\)</span> from <span class="math inline">\(R\)</span> where <span class="math inline">\((s_i, a_i, r_i, s_{i+1})\)</span> are <code>StepType</code></p>
<p>The targets are similar to DQN since we are estimating the <span class="math inline">\(Q\)</span> value:</p>
<p><span class="math inline">\(y_i = r_i + \gamma Q' (s_{i+1}, \mu'(s_{i+1} | \theta^{\mu'})|\theta^{Q'})\)</span></p>
<p>Where <span class="math inline">\(y_i\)</span> is the <code>targets</code>, <span class="math inline">\(\gamma\)</span> is the <code>discount**nsteps</code>, <span class="math inline">\(Q'\)</span> is the <code>t_critic</code>, <span class="math inline">\(\mu'\)</span> is the <code>t_actor</code>.</p>
<p><span class="math inline">\(\mu'(s_{i+1} | \theta^{\mu'})\)</span> is the <code>t_actors</code> predicted actions of <code>s_{i+1}</code></p>
<p>Update critic by minimizing the loss: <span class="math inline">\(L = \frac{1}{N}\sum_i{y_i - Q(s_i,a_i|\theta^Q))^2}\)</span></p>
<p>Where <span class="math inline">\(Q(s_i,a_i|\theta^Q)\)</span> is <code>critic(batch.state,batch.action)</code> and anything with <span class="math inline">\(\frac{1}{N}\sum_i{(...)}^2\)</span> is just <code>nn.MSELoss</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">0</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> GymTransformBlock(agent<span class="op">=</span><span class="va">None</span>,n<span class="op">=</span><span class="dv">1000</span>,bs<span class="op">=</span><span class="dv">64</span>,seed<span class="op">=</span><span class="dv">0</span>)([<span class="st">'Pendulum-v1'</span>])</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> StepBatcher(pipe)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>actor <span class="op">=</span> Actor(<span class="dv">3</span>,<span class="dv">1</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>critic <span class="op">=</span> Critic(<span class="dv">3</span>,<span class="dv">1</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> SoftTargetUpdater(pipe,critic)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> CriticLossProcessor(pipe,critic,actor)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>pipe_loss <span class="op">=</span> LossCollector(pipe,main_buffers<span class="op">=</span>[[]])</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> BasicOptStepper(pipe_loss,critic,<span class="fl">1e-3</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(pipe)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>pipe_loss.show(title<span class="op">=</span><span class="st">'Critic Loss over N-Steps'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="941f1ff3-99f0-4c34-a799-43835c4faab1" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("941f1ff3-99f0-4c34-a799-43835c4faab1")) {                    Plotly.newPlot(                        "941f1ff3-99f0-4c34-a799-43835c4faab1",                        [{"hovertemplate":"variable=0<br>N Steps=%{x}<br>Loss=%{y}<extra></extra>","legendgroup":"0","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"0","orientation":"v","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"xaxis":"x","y":[45.13909912109375,41.036659240722656,35.301029205322266,19.94182777404785,25.4307804107666,14.368118286132812,5.186619281768799,3.6994359493255615,3.606971502304077,11.611700057983398,6.887884616851807,8.977745056152344,11.378144264221191,4.874406814575195,2.864379644393921,4.137446403503418],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"N Steps"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Loss"}},"legend":{"title":{"text":"variable"},"tracegroupgap":0},"title":{"text":"Critic Loss over N-Steps"}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('941f1ff3-99f0-4c34-a799-43835c4faab1');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<hr>
</section>
<section id="actorlossprocessor" class="level3">
<h3 class="anchored" data-anchor-id="actorlossprocessor">ActorLossProcessor</h3>
<blockquote class="blockquote">
<pre><code> ActorLossProcessor (*args, **kwds)</code></pre>
</blockquote>
<p>Produces a critic loss based on <code>critic</code>,<code>actor</code> and batch <code>StepTypes</code> from <code>source_datapipe</code> where the targets and predictions are fed into <code>loss</code>.</p>
<p>(Lilicrap et al., 2016) notes: “The actor is updated by following the applying the chain rule to the expected return from the start distribution J with respect to the actor parameters”</p>
<p>The loss is defined as the “policy gradient” below:</p>
<p><span class="math display">\[
\nabla_{\theta^{\mu}} J \approx \frac{1}{N} \sum_i{\nabla_aQ(s,a|\theta^Q)|_{s={s_i},a={\mu(s_i)}}\nabla_{\theta^{\mu}\mu(s|\theta^Q)|_{s_i}}}
\]</span></p>
<p>Where:</p>
<p><span class="math inline">\(\frac{1}{N} \sum_i\)</span> is the mean.</p>
<p><span class="math inline">\(\nabla_{\theta^{\mu}\mu(s|\theta^Q)|_{s_i}}\)</span> is the <code>actor</code> output.</p>
<p><span class="math inline">\(\nabla_aQ(s,a|\theta^Q)|_{s={s_i},a={\mu(s_i)}}\)</span> is the <code>critic</code> output, using actions from the <code>actor</code>.</p>
<blockquote class="blockquote">
<p>Important: A little confusing point, <span class="math inline">\(\nabla\)</span> is the gradient/derivative of both. The point of the loss is that we want to select actions that have <code>critic</code> output higher values. We can do this by first calling <code>CriticLossProcessor</code> to load <code>critic</code> with gradients, then run it again but with the <code>actor</code> inputs. We want the <code>actor</code> to have the <code>critic</code> produce more positive gradients, than negative i.e: Have actions that maximize the critic outputs. The confusing thing is since pytorch has autograd, the actual code is not going to match the math above, for good and bad.</p>
</blockquote>
<p>TODO: It would be helpful if this documentation can be better explained.</p>
<blockquote class="blockquote">
<p>Note: We actually multiply <code>J</code> by -1 since the optimizer is trying to make the value as “small” as possible, but the actual value we want to be as big as possible. So if we have a <code>J</code> of 100 (high reward), it becomes -100, letting the optimizer know that it is moving is the correct direction (the more negative, the better).</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>actor <span class="op">=</span> Actor(<span class="dv">3</span>,<span class="dv">1</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>critic <span class="op">=</span> Critic(<span class="dv">3</span>,<span class="dv">1</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>agent <span class="op">=</span> DDPGAgent(actor,max_steps<span class="op">=</span><span class="dv">10000</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> GymTransformBlock(agent<span class="op">=</span>agent,n<span class="op">=</span><span class="dv">1000</span>,bs<span class="op">=</span><span class="dv">10</span>)([<span class="st">'Pendulum-v1'</span>])</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> StepBatcher(pipe)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> ActorLossProcessor(pipe,critic,actor)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>pipe_loss <span class="op">=</span> LossCollector(pipe,main_buffers<span class="op">=</span>[[]])</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> BasicOptStepper(pipe_loss,actor,<span class="fl">1e-3</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(pipe)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>pipe_loss.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="8d420aa7-811a-4d6f-aee4-05ce313ebd87" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("8d420aa7-811a-4d6f-aee4-05ce313ebd87")) {                    Plotly.newPlot(                        "8d420aa7-811a-4d6f-aee4-05ce313ebd87",                        [{"hovertemplate":"variable=0<br>N Steps=%{x}<br>Loss=%{y}<extra></extra>","legendgroup":"0","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"0","orientation":"v","showlegend":true,"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99],"xaxis":"x","y":[-0.00964118167757988,-0.00975011382251978,-0.009750040248036385,-0.009636618196964264,-0.00971303228288889,-0.009825830347836018,-0.009619361720979214,-0.00959361344575882,-0.009893525391817093,-0.009675326757133007,-0.009560439735651016,-0.009870253503322601,-0.009805748239159584,-0.00959239061921835,-0.009780248627066612,-0.009799922816455364,-0.009621036238968372,-0.009774409234523773,-0.009852658957242966,-0.009653277695178986,-0.010079121217131615,-0.009915728121995926,-0.010072808712720871,-0.010248275473713875,-0.009949440136551857,-0.010040158405900002,-0.010099404491484165,-0.010870452038943768,-0.010448174551129341,-0.009971792809665203,-0.009986558929085732,-0.0104511808604002,-0.010295174084603786,-0.010491244494915009,-0.00987686961889267,-0.010044582188129425,-0.00998571328818798,-0.009976023808121681,-0.010107094421982765,-0.009906868450343609,-0.00990767776966095,-0.009991290979087353,-0.00999186560511589,-0.010397828184068203,-0.009896203875541687,-0.010107431560754776,-0.010091904550790787,-0.010733281262218952,-0.009946332313120365,-0.009974921122193336,-0.01018191035836935,-0.010131952352821827,-0.009900380857288837,-0.010202938690781593,-0.010634553618729115,-0.01034529972821474,-0.011013561859726906,-0.01032649539411068,-0.009993531741201878,-0.009934316389262676,-0.0100411307066679,-0.009999333880841732,-0.010274814441800117,-0.010354648344218731,-0.010460888966917992,-0.009887587279081345,-0.010071206837892532,-0.010156008414924145,-0.009952184744179249,-0.010038262233138084,-0.010513341054320335,-0.0105705251917243,-0.010632689110934734,-0.010995837859809399,-0.010426854714751244,-0.011002360843122005,-0.010696608573198318,-0.01064436323940754,-0.010984865948557854,-0.0104117002338171,-0.010219307616353035,-0.009889011271297932,-0.00999914575368166,-0.010176240466535091,-0.009933056309819221,-0.010037491098046303,-0.010049043223261833,-0.010294942185282707,-0.009885757230222225,-0.010054221376776695,-0.009967336431145668,-0.010385043919086456,-0.009844925254583359,-0.01012115366756916,-0.010115068405866623,-0.010320557281374931,-0.00987986195832491,-0.010336801409721375,-0.01030289102345705,-0.011100402101874352],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"N Steps"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Loss"}},"legend":{"title":{"text":"variable"},"tracegroupgap":0},"title":{"text":"Loss over N-Steps"}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('8d420aa7-811a-4d6f-aee4-05ce313ebd87');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<hr>
</section>
<section id="ddpglearner" class="level3">
<h3 class="anchored" data-anchor-id="ddpglearner">DDPGLearner</h3>
<blockquote class="blockquote">
<pre><code> DDPGLearner (actor:__main__.Actor, critic:__main__.Critic, dls:List[Union
              [torch.utils.data.datapipes.datapipe.IterDataPipe,torch.util
              s.data.datapipes.datapipe.MapDataPipe,torchdata.dataloader2.
              dataloader2.DataLoader2]], logger_bases:Union[List[fastrl.lo
              ggers.core.LoggerBase],NoneType]=None, actor_lr:float=0.001,
              actor_opt:torch.optim.optimizer.Optimizer=&lt;class
              'torch.optim.adam.Adam'&gt;, critic_lr:float=0.01,
              critic_opt:torch.optim.optimizer.Optimizer=&lt;class
              'torch.optim.adam.Adam'&gt;, critic_target_copy_freq:int=1,
              actor_target_copy_freq:int=1, tau:float=0.001, bs:int=128,
              max_sz:int=10000, nsteps:int=1, device:torch.device=None,
              batches:int=None, dp_augmentation_fns:Union[List[fastrl.pipe
              s.core.DataPipeAugmentationFn],NoneType]=None,
              debug:bool=False)</code></pre>
</blockquote>
<p>DDPG is a continuous action, actor-critic model, first created in (Lilicrap et al., 2016). The critic estimates a Q value estimate, and the actor attempts to maximize that Q value.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>actor</td>
<td>Actor</td>
<td></td>
<td>The actor model to use</td>
</tr>
<tr class="even">
<td>critic</td>
<td>Critic</td>
<td></td>
<td>The critic model to use</td>
</tr>
<tr class="odd">
<td>dls</td>
<td>typing.List[typing.Union[torch.utils.data.datapipes.datapipe.IterDataPipe, torch.utils.data.datapipes.datapipe.MapDataPipe, torchdata.dataloader2.dataloader2.DataLoader2]]</td>
<td></td>
<td>A list of dls, where index=0 is the training dl.</td>
</tr>
<tr class="even">
<td>logger_bases</td>
<td>typing.Union[typing.List[fastrl.loggers.core.LoggerBase], NoneType]</td>
<td>None</td>
<td>Optional logger bases to log training/validation data to.</td>
</tr>
<tr class="odd">
<td>actor_lr</td>
<td>float</td>
<td>0.001</td>
<td>The learning rate for the actor. Expected to learn slower than the critic</td>
</tr>
<tr class="even">
<td>actor_opt</td>
<td>Optimizer</td>
<td>Adam</td>
<td>The optimizer for the actor</td>
</tr>
<tr class="odd">
<td>critic_lr</td>
<td>float</td>
<td>0.01</td>
<td>The learning rate for the critic. Expected to learn faster than the actor</td>
</tr>
<tr class="even">
<td>critic_opt</td>
<td>Optimizer</td>
<td>Adam</td>
<td>The optimizer for the critic<br>Note that weight decay doesnt seem to be great for <br>Pendulum, so we use regular Adam, which has the decay rate<br>set to 0. (Lilicrap et al., 2016) would instead use AdamW</td>
</tr>
<tr class="odd">
<td>critic_target_copy_freq</td>
<td>int</td>
<td>1</td>
<td>Reference: SoftTargetUpdater docs</td>
</tr>
<tr class="even">
<td>actor_target_copy_freq</td>
<td>int</td>
<td>1</td>
<td>Reference: SoftTargetUpdater docs</td>
</tr>
<tr class="odd">
<td>tau</td>
<td>float</td>
<td>0.001</td>
<td>Reference: SoftTargetUpdater docs</td>
</tr>
<tr class="even">
<td>bs</td>
<td>int</td>
<td>128</td>
<td>Reference: ExperienceReplay docs</td>
</tr>
<tr class="odd">
<td>max_sz</td>
<td>int</td>
<td>10000</td>
<td>Reference: ExperienceReplay docs</td>
</tr>
<tr class="even">
<td>nsteps</td>
<td>int</td>
<td>1</td>
<td>Reference: GymStepper docs</td>
</tr>
<tr class="odd">
<td>device</td>
<td>device</td>
<td>None</td>
<td>The device for the entire pipeline to use. Will move the agent, dls, <br>and learner to that device.</td>
</tr>
<tr class="even">
<td>batches</td>
<td>int</td>
<td>None</td>
<td>Number of batches per epoch</td>
</tr>
<tr class="odd">
<td>dp_augmentation_fns</td>
<td>typing.Union[typing.List[fastrl.pipes.core.DataPipeAugmentationFn], NoneType]</td>
<td>None</td>
<td>Any augmentations to the learner</td>
</tr>
<tr class="even">
<td>debug</td>
<td>bool</td>
<td>False</td>
<td>Debug mode will output device moves</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>LearnerHead</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup Loggers</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>logger_base <span class="op">=</span> ProgressBarLogger(epoch_on_pipe<span class="op">=</span>EpocherCollector,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                 batch_on_pipe<span class="op">=</span>BatchCollector)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup up the core NN</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">0</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>actor <span class="op">=</span> Actor(<span class="dv">3</span>,<span class="dv">1</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>critic <span class="op">=</span> Critic(<span class="dv">3</span>,<span class="dv">1</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup the Agent</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>agent <span class="op">=</span> DDPGAgent(actor,[logger_base],max_steps<span class="op">=</span><span class="dv">5000</span>,min_epsilon<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup the DataBlock</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>block <span class="op">=</span> DataBlock(</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    GymTransformBlock(agent<span class="op">=</span>agent,nsteps<span class="op">=</span><span class="dv">2</span>,nskips<span class="op">=</span><span class="dv">2</span>,firstlast<span class="op">=</span><span class="va">True</span>), </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    (GymTransformBlock(agent<span class="op">=</span>agent,n<span class="op">=</span><span class="dv">400</span>,nsteps<span class="op">=</span><span class="dv">2</span>,nskips<span class="op">=</span><span class="dv">2</span>,firstlast<span class="op">=</span><span class="va">True</span>,include_images<span class="op">=</span><span class="va">True</span>),VSCodeTransformBlock())</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> L(block.dataloaders([<span class="st">'Pendulum-v1'</span>]<span class="op">*</span><span class="dv">1</span>))</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup the Learner</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>learner <span class="op">=</span> DDPGLearner(actor,critic,dls,logger_bases<span class="op">=</span>[logger_base],</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>                      bs<span class="op">=</span><span class="dv">128</span>,max_sz<span class="op">=</span><span class="dv">20_000</span>,nsteps<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>                      batches<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co"># learner.fit(1)</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>learner.fit(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>actor-loss</th>
      <th>critic-loss</th>
      <th>episode</th>
      <th>rolling_reward</th>
      <th>epoch</th>
      <th>batch</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>23.484377</td>
      <td>2.7217586</td>
      <td>10</td>
      <td>-1606.006924</td>
      <td>1</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>31.69706</td>
      <td>12.016734</td>
      <td>20</td>
      <td>-1542.288166</td>
      <td>2</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>40.06336</td>
      <td>25.084415</td>
      <td>30</td>
      <td>-1472.712552</td>
      <td>3</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>50.46943</td>
      <td>7.714135</td>
      <td>40</td>
      <td>-1450.873017</td>
      <td>4</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>59.180523</td>
      <td>17.604204</td>
      <td>50</td>
      <td>-1406.556492</td>
      <td>5</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>67.14108</td>
      <td>46.2947</td>
      <td>60</td>
      <td>-1338.766411</td>
      <td>6</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>68.84964</td>
      <td>16.201414</td>
      <td>70</td>
      <td>-1135.972938</td>
      <td>7</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>69.09436</td>
      <td>143.93195</td>
      <td>80</td>
      <td>-993.549349</td>
      <td>8</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>69.35192</td>
      <td>25.970486</td>
      <td>90</td>
      <td>-817.256042</td>
      <td>9</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>73.09758</td>
      <td>171.4342</td>
      <td>100</td>
      <td>-673.698936</td>
      <td>10</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>74.067116</td>
      <td>261.42377</td>
      <td>110</td>
      <td>-546.182211</td>
      <td>11</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>71.98171</td>
      <td>119.34804</td>
      <td>119</td>
      <td>-492.149361</td>
      <td>12</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>72.43381</td>
      <td>239.37431</td>
      <td>129</td>
      <td>-445.763457</td>
      <td>13</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>74.57726</td>
      <td>23.358807</td>
      <td>139</td>
      <td>-408.875556</td>
      <td>14</td>
      <td>1001</td>
    </tr>
    <tr>
      <td>61.790493</td>
      <td>230.8901</td>
      <td>149</td>
      <td>-369.512350</td>
      <td>14</td>
      <td>1001</td>
    </tr>
  </tbody>
</table>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>